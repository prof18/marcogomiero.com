<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to persist Ktor logs - Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SERIES: Building a backend with Ktor
Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5 Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor Logs are a vital part of software development."><meta property="og:image" content><meta property="og:title" content="How to persist Ktor logs"><meta property="og:description" content="SERIES: Building a backend with Ktor
Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5 Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor Logs are a vital part of software development."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2021/ktor-logging-on-disk/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-05T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-05T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to persist Ktor logs"><meta name=twitter:description content="SERIES: Building a backend with Ktor
Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5 Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor Logs are a vital part of software development."><script src=https://www.marcogomiero.com/js/feather.min.js></script>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.marcogomiero.com/css/main.f2c7f60ec2d0155a784ade9b1b272143e1b8eb864a95bf75e606b49d8774389e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://www.marcogomiero.com/css/dark.2d1f13dc82ea2d94683809543a326af8a9a1f3a6c000f7b7af5d8f02a2e6ec25.css disabled></head><body><div class=content><header><div class=main><a href=https://www.marcogomiero.com><h2>Marco Gomiero</h2></a></div><nav class=navbar><a href=/posts/><span>Write</span></a>
<a href=/talks/><span>Speak</span></a>
<a href=/projects/><span>Build</span></a>
<a href=/about-me/><span>About</span></a>
| <span class=dark-mode-toggle id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.marcogomiero.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>How to persist Ktor logs</h1><div class=post-meta><span title='2021-05-05 00:00:00 +0000 UTC'>5 May 2021</span></div></div><section class=body><span class=raw-html><a href="https://us12.campaign-archive.com/?u=f39692e245b94f7fb693b6d82&id=e568e58261"><img style=margin:0 src=https://img.shields.io/badge/Featured%20in%20kotlinweekly.net-Issue%20%23249-%237874b4></a></span><blockquote><p><strong>SERIES: Building a backend with Ktor</strong></p><ul><li>Part 1: <a href=https://www.marcogomiero.com/posts/2021/ktor-project-structure/>Structuring a Ktor project</a></li><li>Part 2: How to persist Ktor logs</li><li>Part 3: <a href=https://www.marcogomiero.com/posts/2021/ktor-in-memory-db-testing/>How to use an in-memory database for testing on Ktor</a></li><li>Part 4: <a href=https://www.marcogomiero.com/posts/2022/ktor-migration-liquibase/>How to handle database migrations with Liquibase on Ktor</a></li><li>Part 5 <a href=https://www.marcogomiero.com/posts/2022/ktor-setup-documentation/>Generate API documentation from Swagger on Ktor</a></li><li>Part 6: <a href=https://www.marcogomiero.com/posts/2022/ktor-jobs-quartz/>How to schedule jobs with Quartz on Ktor</a></li><li>Part 7: <a href=https://www.marcogomiero.com/posts/2022/backend-from-mobile-ktor/>Moving from mobile to backend development with Ktor</a></li></ul></blockquote><p>Logs are a vital part of software development. They can be used for debugging, to track specific events during the lifecycle of the product, or to discover unexpected events.</p><p>Usually, logs are printed in the system output, so they must be saved somewhere to be accessed and read sometime in the future. To achieve persistence it is possible to use a cloud service, like <a href=https://www.datadoghq.com/ts/logs/log-management/>Datadog</a> that receives, processes and maintains all the logs. Cherry on top, it also gives you monitoring and analysis tools right out of the box.</p><p>However, I think that, in the case of an MVP or an early-stage product, using such services can be overkill. It’s enough to persist the logs in the server and access them later.</p><p>In this post, I will show how to save on a file the logs produced by a Ktor backend. This post is part of a series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that was not easy to achieve out of the box. You can check out the other instances of the series in the index above or <a href=https://twitter.com/marcoGomier>follow me on Twitter</a> to keep up to date.</p><h2 id=setup-logging-on-ktor>Setup logging on Ktor</h2><p>When creating a new Ktor project, the wizard automatically adds the <a href=http://www.slf4j.org/index.html>SLF4J library</a> to handle logging.</p><p>During the initialization of the server, Ktor automatically creates an instance of the <em>Logger</em> and then it is possible to retrieve that instance <a href=https://ktor.io/docs/logging.html#access_logger>in different ways</a>. Instead, on business logic classes the <em>Logger</em> instance can be retrieved from the <code>LoggerFactory</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>val</span> logger = LoggerFactory.getLogger(MyClass<span style=color:#ff6ac1>::</span><span style=color:#ff6ac1>class</span>.java)
</span></span></code></pre></div><p>To avoid writing every time this long line, an helper method can be used:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>inline</span> <span style=color:#ff6ac1>fun</span> &lt;<span style=color:#ff6ac1>reified</span> <span style=color:#f3f99d>T</span>&gt; <span style=color:#57c7ff>T</span>.getLogger(): Logger {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> LoggerFactory.getLogger(T<span style=color:#ff6ac1>::</span><span style=color:#ff6ac1>class</span>.java)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>class</span> <span style=color:#f3f99d>MyClass</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>private</span> <span style=color:#ff6ac1>val</span> logger = getLogger()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>fun</span> <span style=color:#57c7ff>main</span>() {
</span></span><span style=display:flex><span>        logger.info(<span style=color:#5af78e>&#34;Hello World&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=logger-customization>Logger Customization</h2><p>The Logger can be customized with an <em>xml</em> file named <code>logback.xml</code>. On project creation, a default <code>logback</code> file is created and placed in the application <code>resources</code> directory.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;pattern&gt;</span>%d{YYYY-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#ff6ac1>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;root</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;trace&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;appender-ref</span> <span style=color:#57c7ff>ref=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/root&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;org.eclipse.jetty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;io.netty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>The file contains three different blocks of configurations (this division is just visual and conceptual, of course, the order of the different entries can be changed and mixed).</p><p>In the first block, the <code>Appenders</code> are defined. An <em>Appender</em> is responsible to place the log messages in a specific destination.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;pattern&gt;</span>%d{YYYY-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#ff6ac1>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>In this case, the <code>ConsoleAppender</code> will send the log messages in the Console, i.e. in the Standard Output. Inside the Appender customization, it is also possible to specify the format of the message and add useful information like the timestamp, the logger, the thread, etc.</p><p>The second block defines for each appender, the level of logging. The levels are 5: <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, <code>TRACE</code>, and the chosen one includes also the previous. For example, if you choose the <code>TRACE</code> level, all the messages will be sent, and if you choose the <code>INFO</code> level, only the messages with level <code>INFO</code>, <code>WARN</code>, and <code>ERROR</code> will be sent.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;root</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;trace&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;appender-ref</span> <span style=color:#57c7ff>ref=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/root&gt;</span>
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>In this case, since the appender has logging level <code>TRACE</code>, all the log messages will be sent to the Standard Output.</p><p>In the third level instead, it is possible to customize the level of a specific logger.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;org.eclipse.jetty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;io.netty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>For example, the <code>DEBUG</code> level can be set for a specific class that is not stable yet.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;com.company.package.MyClass&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;DEBUG&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span></code></pre></div><p>If necessary, it is also possible to change at the same time all the levels of the Logger:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>val</span> root = LoggerFactory.getLogger(org.slf4j.Logger.ROOT_LOGGER_NAME) <span style=color:#ff6ac1>as</span> Logger
</span></span><span style=display:flex><span>root.level = ch.qos.logback.classic.Level.TRACE
</span></span></code></pre></div><p>This is useful for example to customize the log level if the instance is running on a staging or production server.</p><h2 id=logging-on-file>Logging on file</h2><p>As you can imagine, to save the log on a file it is necessary to change the <code>Appender</code>. There is <code>FileAppender</code> and <code>RollingFileAppender</code> and I’m going to use the latter.</p><p>As the name suggests, a <code>RollingFileAppender</code>, does not save the logs in the same file but it “rolls” on different files depending on time, file size, or a mix of the two. This is a smarter solution to choose because otherwise, the log file will be too heavy when used for several days over.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;FILE&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;file&gt;</span>${LOG_DEST}/ktor-chuck-norris-sample.log<span style=color:#ff6ac1>&lt;/file&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;rollingPolicy</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>&lt;!-- daily rollover --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;fileNamePattern&gt;</span>${LOG_DEST}/ktor-chuck-norris-sample.%d{yyyy-MM-dd}.log<span style=color:#ff6ac1>&lt;/fileNamePattern&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>&lt;!-- keep 90 days&#39; worth of history capped at 3GB total size --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;maxHistory&gt;</span>${LOG_MAX_HISTORY}<span style=color:#ff6ac1>&lt;/maxHistory&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;totalSizeCap&gt;</span>3GB<span style=color:#ff6ac1>&lt;/totalSizeCap&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/rollingPolicy&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;pattern&gt;</span>%d{YYYY-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#ff6ac1>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>First of all, in the <code>RollingFileAppender</code> it is necessary to specify the file where the logs will be saved. To define the location I’ve used an environment variable, so in this way, I can switch locations when I’m running the backend on my local machine.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;FILE&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;file&gt;</span>${LOG_DEST}/ktor-chuck-norris-sample.log<span style=color:#ff6ac1>&lt;/file&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;appender&gt;</span>
</span></span></code></pre></div><p>The variable is then specified in the VM Options field of the running configuration on IntelliJ</p><figure><a href=/img/ktor-log-disk/ktor-log-run-config.png><img src=/img/ktor-log-disk/ktor-log-run-config.png></a></figure><p>or in the command line when launching the backend.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -DLOG_DEST<span style=color:#ff6ac1>=</span>/rbe-data/logs ...
</span></span></code></pre></div><p>After the location, it is necessary to define a rolling policy. In this case, I will use a <code>TimeBasedRollingPolicy</code>, that changes every day the file where the logs are saved. Plus, it will append the date to the old files, to make them more recognizable.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>├── logs
</span></span><span style=display:flex><span>│   ├── ktor-chuck-norris-sample.2021-03-09.log
</span></span><span style=display:flex><span>│   └── ktor-chuck-norris-sample.log
</span></span></code></pre></div><p>In the <code>TimeBasedRollingPolicy</code>, it is also possible to specify a limit on the number of days to persist and total max size. In this case, I’ve specified a maximum of 90 days and 3 GB size. So if there will be 3 GB of data on the 78th day, the logger will start automatically to drop the 1st day of log and so on.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;FILE&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;rollingPolicy</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#78787e>&lt;!-- daily rollover --&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#ff6ac1>&lt;fileNamePattern&gt;</span>${LOG_DEST}/ktor-chuck-norris-sample.%d{yyyy-MM-dd}.log<span style=color:#ff6ac1>&lt;/fileNamePattern&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#78787e>&lt;!-- keep 90 days&#39; worth of history capped at 3GB total size --&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#ff6ac1>&lt;maxHistory&gt;</span>${LOG_MAX_HISTORY}<span style=color:#ff6ac1>&lt;/maxHistory&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#ff6ac1>&lt;totalSizeCap&gt;</span>3GB<span style=color:#ff6ac1>&lt;/totalSizeCap&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/rollingPolicy&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span></code></pre></div><p>As for the location, I’ve used an environmental variable for the days, so in this way, I can set only one day of logs when I run the backend on my local machine.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -DLOG_DEST<span style=color:#ff6ac1>=</span>/rbe-data/logs -DLOG_MAX_HISTORY<span style=color:#ff6ac1>=</span>90...
</span></span></code></pre></div><p>And as reference, here’s the entire <em>logback</em> file that I’ve described:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;pattern&gt;</span>%d{YYYY-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#ff6ac1>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;FILE&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;file&gt;</span>${LOG_DEST}/ktor-chuck-norris-sample.log<span style=color:#ff6ac1>&lt;/file&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;rollingPolicy</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>&lt;!-- daily rollover --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;fileNamePattern&gt;</span>${LOG_DEST}/ktor-chuck-norris-sample.%d{yyyy-MM-dd}.log<span style=color:#ff6ac1>&lt;/fileNamePattern&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#78787e>&lt;!-- keep 90 days&#39; worth of history capped at 3GB total size --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;maxHistory&gt;</span>${LOG_MAX_HISTORY}<span style=color:#ff6ac1>&lt;/maxHistory&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;totalSizeCap&gt;</span>3GB<span style=color:#ff6ac1>&lt;/totalSizeCap&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/rollingPolicy&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;pattern&gt;</span>%d{YYYY-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#ff6ac1>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;root</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;info&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;appender-ref</span> <span style=color:#57c7ff>ref=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;appender-ref</span> <span style=color:#57c7ff>ref=</span><span style=color:#5af78e>&#34;FILE&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/root&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;org.eclipse.jetty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;io.netty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><h2 id=logging-during-tests>Logging during tests</h2><p>While running tests is not necessary to save logs on file (at least in my case). To customize logging during testing, it is necessary to specify a <code>logback-test.xml</code> inside the <code>test/resources</code> directory.</p><p>In my case, I just wanted a simple <code>ConsoleAppender</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;appender</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span> <span style=color:#57c7ff>class=</span><span style=color:#5af78e>&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>&lt;pattern&gt;</span>%d{YYYY-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#ff6ac1>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;root</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;info&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;appender-ref</span> <span style=color:#57c7ff>ref=</span><span style=color:#5af78e>&#34;STDOUT&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/root&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;org.eclipse.jetty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;io.netty&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;Exposed&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;logger</span> <span style=color:#57c7ff>name=</span><span style=color:#5af78e>&#34;ktor.test&#34;</span> <span style=color:#57c7ff>level=</span><span style=color:#5af78e>&#34;INFO&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/configuration&gt;</span>
</span></span></code></pre></div><h2 id=conclusions>Conclusions</h2><p>And that’s it for today. You can find the code mentioned in the article on <a href=https://github.com/prof18/ktor-chuck-norris-sample/tree/main/part2>GitHub</a>.</p><p>In the next episodes, I’ll cover in-memory database and migrations. You can follow me on <a href=https://twitter.com/marcoGomier>Twitter</a> to know when I’ll publish the next episode.</p></section><div class=article-footer><div class=body>To stay up to date with my writing and my projects, follow me on <a href=https://androiddev.social/@marcogom target=_blank>Mastodon</a> or <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-69FZ1TLE7E","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>