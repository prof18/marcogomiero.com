<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30 - Marco Gomiero</title><meta name=Description content="Software Engineer · Google Developer Expert for Kotlin"><meta property="og:title" content="Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30"><meta property="og:description" content="A few days ago, Kotlin 1.5.30 has been released. One of the features contained in the release is the official support for XCFrameworks on Kotlin Multiplatform.
XCFramework is a binary that can contain multiple platform-specific variants (even for iOS and macOS at the same time). It has been introduced by Apple during the WWDC 2019 as a replacement for FatFrameworks.
Before Kotlin 1.5.30, an XCFramework could be created only by running the xcrun command that will pack the frameworks for every different required platform into an XCFramework."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30"><meta name=twitter:description content="A few days ago, Kotlin 1.5.30 has been released. One of the features contained in the release is the official support for XCFrameworks on Kotlin Multiplatform.
XCFramework is a binary that can contain multiple platform-specific variants (even for iOS and macOS at the same time). It has been introduced by Apple during the WWDC 2019 as a replacement for FatFrameworks.
Before Kotlin 1.5.30, an XCFramework could be created only by running the xcrun command that will pack the frameworks for every different required platform into an XCFramework."><meta name=application-name content="Marco Gomiero"><meta name=apple-mobile-web-app-title content="Marco Gomiero"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support/><link rel=prev href=https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/><link rel=next href=https://www.marcogomiero.com/posts/2021/ktor-in-memory-db-testing/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.marcogomiero.com\/posts\/2021\/kmp-xcframework-official-support\/"},"image":["https:\/\/www.marcogomiero.com\/images\/Apple-Devices-Preview.png"],"genre":"posts","wordcount":984,"url":"https:\/\/www.marcogomiero.com\/posts\/2021\/kmp-xcframework-official-support\/","datePublished":"2021-08-30T00:00:00+00:00","dateModified":"2021-08-30T00:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Marco Gomiero"},"author":{"@type":"Person","name":"Marco Gomiero"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Marco Gomiero">Marco Gomiero</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts>Posts </a><a class=menu-item href=/talks>Talks </a><a class=menu-item href=/projects>Projects </a><a class=menu-item href=/about-me>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Marco Gomiero">Marco Gomiero</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts title>Posts</a><a class=menu-item href=/talks title>Talks</a><a class=menu-item href=/projects title>Projects</a><a class=menu-item href=/about-me title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel=stylesheet><main class=main><div class=container><article class="page single"><h1 class=single-title>Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30</h1><br><div class=post-meta><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="30 Aug 2021">30 Aug 2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;984 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div></div><br><div class=content id=content><div id=banner style=overflow:hidden;justify-content:space-around><div style=display:inline-block><a href=https://mailchi.mp/kotlinweekly/kotlin-weekly-266><img style=margin:0 src=https://img.shields.io/badge/Featured%20in%20kotlinweekly.net-Issue%20%23266-%237874b4></a></div></div><p>A few days ago, <a href=https://kotlinlang.org/docs/whatsnew1530.html target=_blank rel="noopener noreffer">Kotlin 1.5.30 has been released</a>. One of the features contained in the release is the official support for XCFrameworks on Kotlin Multiplatform.</p><p><a href=https://help.apple.com/xcode/mac/11.4/#/dev544efab96 target=_blank rel="noopener noreffer">XCFramework</a> is a binary that can contain multiple platform-specific variants (even for iOS and macOS at the same time). It has been introduced by Apple during the <a href=https://developer.apple.com/videos/play/wwdc2019/416/ target=_blank rel="noopener noreffer">WWDC 2019</a> as a replacement for FatFrameworks.</p><p>Before Kotlin 1.5.30, an XCFramework could be created only by running the <code>xcrun</code> command that will pack the frameworks for every different required platform into an XCFramework.</p><p>A few weeks ago, I wrote <a href=https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/ target=_blank rel="noopener noreffer">an article</a> to show how to create two Gradle tasks (<code>buildDebugXCFramework</code> and <code>buildReleaseXCFramework</code>) to automate the building of an XCFramework. With Kotlin 1.5.30 these tasks are not necessary anymore and in this article, I will show you how to replace the custom tasks with the official ones.</p><h2 id=build-an-xcframework-with-kotlin-1530>Build an XCFramework with Kotlin 1.5.30</h2><p>To start using XCFrameworks, it is necessary to create an XCFramework object inside the <code>kotlin</code> block of the <code>build.gradle.kts</code> file. Then, every Apple target should be added to that object.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>import</span> <span class=nn>org.jetbrains.kotlin.gradle.plugin.mpp.apple.XCFramework</span>

<span class=k>val</span> <span class=py>libName</span> <span class=p>=</span> <span class=err>“</span><span class=n>LibraryName</span><span class=err>”</span>

<span class=n>kotlin</span> <span class=p>{</span>
    <span class=k>val</span> <span class=py>xcFramework</span> <span class=p>=</span> <span class=n>XCFramework</span><span class=p>(</span><span class=n>libName</span><span class=p>)</span>

    <span class=n>ios</span> <span class=p>{</span>
        <span class=n>binaries</span><span class=p>.</span><span class=n>framework</span><span class=p>(</span><span class=n>libName</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>xcFramework</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}</span>
    
    <span class=o>..</span><span class=p>.</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>After declaring the XCFramework object, three new tasks are added:</p><ul><li>assemble${libName}XCFramework</li><li>assemble${libName}DebugXCFramework</li><li>assemble${libName}ReleaseXCFramework</li></ul><p>The first one will create both the release and the debug version of the XCFramework, while the others will create only the requested variant.</p><p>The XCFrameworks are located in the <code>XCFrameworks</code> folder inside the <code>build</code> folder. There will be a subfolder for each of the built variants.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>.
├── build
    ├── XCFrameworks
        ├── debug
        │   └── LibraryName.xcframework
        └── release
            └── LibraryName.xcframework
</code></pre></td></tr></table></div></div><h2 id=publish-an-xcframework>Publish an XCFramework</h2><p>The newly built XCFramework can now be distributed. The distribution can be archived in different ways: for example in a <em><a href=https://cocoapods.org/ target=_blank rel="noopener noreffer">CocoaPods</a></em> repository, in the <a href=https://swift.org/package-manager/ target=_blank rel="noopener noreffer">Swift Package Manager</a> or with <a href=https://github.com/Carthage/Carthage target=_blank rel="noopener noreffer">Carthage</a>. Since I’m familiar with CocoaPods, that’s what I’ve always used.</p><p>To make the publishing process as streamlined as possible, I’ve written a bunch of Gradle tasks to automatically build and publish through git the Debug and Release version of the XCFramework. For the details and to understand how the task works, I suggest you give a look at <a href=https://www.marcogomiero.com/posts/2021/kmp-existing-project/ target=_blank rel="noopener noreffer">this article</a> that I wrote a few months ago.</p><p>These tasks are the same used in <a href=https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/ target=_blank rel="noopener noreffer">the article</a> that I wrote a few weeks ago about XCFrameworks. But they must be updated, since the tasks to build the XCFramework are changed.</p><p><strong><ins>Publish Debug Version<ins></strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=n>register</span><span class=p>(</span><span class=s2>&#34;publishDevFramework&#34;</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>description</span> <span class=p>=</span> <span class=s2>&#34;Publish iOs framework to the Cocoa Repo&#34;</span>

    <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
        <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
        <span class=n>commandLine</span><span class=p>(</span><span class=s2>&#34;git&#34;</span><span class=p>,</span> <span class=s2>&#34;checkout&#34;</span><span class=p>,</span> <span class=s2>&#34;develop&#34;</span><span class=p>).</span><span class=n>standardOutput</span>
    <span class=p>}</span>

    <span class=n>dependsOn</span><span class=p>(</span><span class=s2>&#34;assemble</span><span class=si>${libName}</span><span class=s2>DebugXCFramework&#34;</span><span class=p>)</span>

    <span class=n>doLast</span> <span class=p>{</span>

        <span class=n>copy</span> <span class=p>{</span>
            <span class=n>from</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$buildDir</span><span class=s2>/XCFrameworks/debug&#34;</span><span class=p>)</span>
            <span class=n>into</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
        <span class=p>}</span>

        <span class=k>val</span> <span class=py>dir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest/</span><span class=si>$libName</span><span class=s2>.podspec&#34;</span><span class=p>)</span>
        <span class=k>val</span> <span class=py>tempFile</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest/</span><span class=si>$libName</span><span class=s2>.podspec.new&#34;</span><span class=p>)</span>

        <span class=k>val</span> <span class=py>reader</span> <span class=p>=</span> <span class=n>dir</span><span class=p>.</span><span class=n>bufferedReader</span><span class=p>()</span>
        <span class=k>val</span> <span class=py>writer</span> <span class=p>=</span> <span class=n>tempFile</span><span class=p>.</span><span class=n>bufferedWriter</span><span class=p>()</span>
        <span class=k>var</span> <span class=py>currentLine</span><span class=p>:</span> <span class=n>String</span><span class=p>?</span>

        <span class=k>while</span> <span class=p>(</span><span class=n>reader</span><span class=p>.</span><span class=n>readLine</span><span class=p>().</span><span class=n>also</span> <span class=p>{</span> <span class=n>currLine</span> <span class=o>-&gt;</span> <span class=n>currentLine</span> <span class=p>=</span> <span class=n>currLine</span> <span class=p>}</span> <span class=o>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>currentLine</span><span class=o>?.</span><span class=n>startsWith</span><span class=p>(</span><span class=s2>&#34;s.version&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=k>true</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>writer</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;s.version       = </span><span class=se>\&#34;</span><span class=si>${libVersionName}</span><span class=se>\&#34;</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=n>System</span><span class=p>.</span><span class=n>lineSeparator</span><span class=p>())</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=n>writer</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=n>currentLine</span> <span class=p>+</span> <span class=n>System</span><span class=p>.</span><span class=n>lineSeparator</span><span class=p>())</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=n>writer</span><span class=p>.</span><span class=n>close</span><span class=p>()</span>
        <span class=n>reader</span><span class=p>.</span><span class=n>close</span><span class=p>()</span>
        <span class=k>val</span> <span class=py>successful</span> <span class=p>=</span> <span class=n>tempFile</span><span class=p>.</span><span class=n>renameTo</span><span class=p>(</span><span class=n>dir</span><span class=p>)</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>successful</span><span class=p>)</span> <span class=p>{</span>

            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span>
                    <span class=s2>&#34;git&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;add&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;.&#34;</span>
                <span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>

            <span class=k>val</span> <span class=py>dateFormatter</span> <span class=p>=</span> <span class=n>SimpleDateFormat</span><span class=p>(</span><span class=s2>&#34;dd/MM/yyyy - HH:mm&#34;</span><span class=p>,</span> <span class=n>Locale</span><span class=p>.</span><span class=n>getDefault</span><span class=p>())</span>
            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span>
                    <span class=s2>&#34;git&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;commit&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;-m&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>New dev release: </span><span class=si>${libVersionName}</span><span class=s2>-</span><span class=si>${dateFormatter.format(Date())}</span><span class=se>\&#34;</span><span class=s2>&#34;</span>
                <span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>

            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span><span class=s2>&#34;git&#34;</span><span class=p>,</span> <span class=s2>&#34;push&#34;</span><span class=p>,</span> <span class=s2>&#34;origin&#34;</span><span class=p>,</span> <span class=s2>&#34;develop&#34;</span><span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>The task now depends on the <code>assemble${libName}DebugXCFramework</code> task, which is officially provided by Kotlin. Then, the only thing to do is to move the XCFramework from the <code>build</code> folder to the CocoaPod repository.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=n>copy</span> <span class=p>{</span>
    <span class=n>from</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$buildDir</span><span class=s2>/XCFrameworks/debug&#34;</span><span class=p>)</span>
    <span class=n>into</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>The task that publishes the release version of the XCFramework is pretty much the same as the debug one, except for the task to build the framework, that is <code>assemble${libName}ReleaseXCFramework</code>, and the location in the <code>build</code> folder:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=n>register</span><span class=p>(</span><span class=s2>&#34;publishFramework&#34;</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>description</span> <span class=p>=</span> <span class=s2>&#34;Publish iOs framework to the Cocoa Repo&#34;</span>

    <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
        <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
        <span class=n>commandLine</span><span class=p>(</span><span class=s2>&#34;git&#34;</span><span class=p>,</span> <span class=s2>&#34;checkout&#34;</span><span class=p>,</span> <span class=s2>&#34;master&#34;</span><span class=p>).</span><span class=n>standardOutput</span>
    <span class=p>}</span>

    <span class=c1>// Create Release Framework for Xcode
</span><span class=c1></span>    <span class=n>dependsOn</span><span class=p>(</span><span class=s2>&#34;assemble</span><span class=si>${libName}</span><span class=s2>ReleaseXCFramework&#34;</span><span class=p>)</span>

    <span class=c1>// Replace
</span><span class=c1></span>    <span class=n>doLast</span> <span class=p>{</span>

        <span class=n>copy</span> <span class=p>{</span>
            <span class=n>from</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$buildDir</span><span class=s2>/XCFrameworks/release&#34;</span><span class=p>)</span>
            <span class=n>into</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
        <span class=p>}</span>

        <span class=k>val</span> <span class=py>dir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest/</span><span class=si>$libName</span><span class=s2>.podspec&#34;</span><span class=p>)</span>
        <span class=k>val</span> <span class=py>tempFile</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest/</span><span class=si>$libName</span><span class=s2>.podspec.new&#34;</span><span class=p>)</span>

        <span class=k>val</span> <span class=py>reader</span> <span class=p>=</span> <span class=n>dir</span><span class=p>.</span><span class=n>bufferedReader</span><span class=p>()</span>
        <span class=k>val</span> <span class=py>writer</span> <span class=p>=</span> <span class=n>tempFile</span><span class=p>.</span><span class=n>bufferedWriter</span><span class=p>()</span>
        <span class=k>var</span> <span class=py>currentLine</span><span class=p>:</span> <span class=n>String</span><span class=p>?</span>

        <span class=k>while</span> <span class=p>(</span><span class=n>reader</span><span class=p>.</span><span class=n>readLine</span><span class=p>().</span><span class=n>also</span> <span class=p>{</span> <span class=n>currLine</span> <span class=o>-&gt;</span> <span class=n>currentLine</span> <span class=p>=</span> <span class=n>currLine</span> <span class=p>}</span> <span class=o>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>currentLine</span><span class=o>?.</span><span class=n>startsWith</span><span class=p>(</span><span class=s2>&#34;s.version&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=k>true</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>writer</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;s.version       = </span><span class=se>\&#34;</span><span class=si>${libVersionName}</span><span class=se>\&#34;</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=n>System</span><span class=p>.</span><span class=n>lineSeparator</span><span class=p>())</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=n>writer</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=n>currentLine</span> <span class=p>+</span> <span class=n>System</span><span class=p>.</span><span class=n>lineSeparator</span><span class=p>())</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=n>writer</span><span class=p>.</span><span class=n>close</span><span class=p>()</span>
        <span class=n>reader</span><span class=p>.</span><span class=n>close</span><span class=p>()</span>
        <span class=k>val</span> <span class=py>successful</span> <span class=p>=</span> <span class=n>tempFile</span><span class=p>.</span><span class=n>renameTo</span><span class=p>(</span><span class=n>dir</span><span class=p>)</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>successful</span><span class=p>)</span> <span class=p>{</span>

            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span>
                    <span class=s2>&#34;git&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;add&#34;</span><span class=p>,</span>
                    <span class=s2>&#34;.&#34;</span>
                <span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>

            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span><span class=s2>&#34;git&#34;</span><span class=p>,</span> <span class=s2>&#34;commit&#34;</span><span class=p>,</span> <span class=s2>&#34;-m&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>New release: </span><span class=si>${libVersionName}</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>

            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span><span class=s2>&#34;git&#34;</span><span class=p>,</span> <span class=s2>&#34;tag&#34;</span><span class=p>,</span> <span class=n>libVersionName</span><span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>

            <span class=n>project</span><span class=p>.</span><span class=n>exec</span> <span class=p>{</span>
                <span class=n>workingDir</span> <span class=p>=</span> <span class=n>File</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$rootDir</span><span class=s2>/../kmp-xcframework-dest&#34;</span><span class=p>)</span>
                <span class=n>commandLine</span><span class=p>(</span><span class=s2>&#34;git&#34;</span><span class=p>,</span> <span class=s2>&#34;push&#34;</span><span class=p>,</span> <span class=s2>&#34;origin&#34;</span><span class=p>,</span> <span class=s2>&#34;master&#34;</span><span class=p>,</span> <span class=s2>&#34;--tags&#34;</span><span class=p>).</span><span class=n>standardOutput</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>And that’s it! With these little modifications, it is possible to use the official Kotlin support for XCFrameworks and automatically publish them in a CocoaPod repository.</p><p>On GitHub, I’ve updated the sample project with the new tasks on the <a href=https://github.com/prof18/kmp-xcframework-sample/tree/kotlin-1.5.30 target=_blank rel="noopener noreffer">kotlin-1.5.30 branch</a>. Instead, if you are interested in XCFramework support before Kotlin 1.5.30, you can look at the <a href=https://github.com/prof18/kmp-xcframework-sample/tree/pre-kotlin-1.5.30 target=_blank rel="noopener noreffer">pre-kotlin-1.5.30</a> branch. And to see what are the changes between the two branches, you can look <a href=https://github.com/prof18/kmp-xcframework-sample/commit/18fb4ec0fad6ec2b058a2a543c0c1de914c0a0c9#diff-c0dfa6bc7a8685217f70a860145fbdf416d449eaff052fa28352c5cec1a98c06 target=_blank rel="noopener noreffer">at this commit</a>.</p></div><section style=width:90%;margin-left:auto;margin-right:auto;margin-top:30px;margin-bottom:30px><hr><div style=padding:25px><div class=content>To stay up to date with my writing and my projects, follow me on <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div><hr></section><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support/ data-title="Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30" data-via=marcoGomier><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support/ data-title="Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2021/build-xcframework-kmp/ class=prev rel=prev title="How to build an XCFramework on Kotlin Multiplatform"><i class="fas fa-angle-left fa-fw"></i>How to build an XCFramework on Kotlin Multiplatform</a>
<a href=/posts/2021/ktor-in-memory-db-testing/ class=next rel=next title="How to use an in-memory database for testing on Ktor">How to use an in-memory database for testing on Ktor<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2017 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.marcogomiero.com/ target=_blank>Marco Gomiero</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e5},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-90975904-1 ',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-90975904-1%20" async></script></body></html>