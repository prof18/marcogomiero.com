<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to build an XCFramework on Kotlin Multiplatform | Marco Gomiero</title><meta name=keywords content><meta name=description content="When you start integrating Kotlin Multiplatform (I‚Äôll call it KMP in the rest of the article) in an existing project you most likely don‚Äôt have a mono-repo structure (and making a refactor to achieve this kind of architecture will not be easy). An example of architecture is the following, with a repository for every platform.
To understand how to integrate KMP into existing code, give a look at my previous article: ‚ÄúIntroducing Kotlin Multiplatform in an existing project‚Äù"><meta name=author content="Marco Gomiero"><link rel=canonical href=https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/><link crossorigin=anonymous href=/assets/css/stylesheet.min.686715e54e31dbf63447efd76235e41e047fd8826df608657b7b0ddb3a0d900d.css integrity="sha256-aGcV5U4x2/Y0R+/XYjXkHgR/2IJt9ghle3sN2zoNkA0=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.marcogomiero.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.marcogomiero.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.marcogomiero.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.marcogomiero.com/apple-touch-icon.png><link rel=mask-icon href=https://www.marcogomiero.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-90975904-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="How to build an XCFramework on Kotlin Multiplatform"><meta property="og:description" content="When you start integrating Kotlin Multiplatform (I‚Äôll call it KMP in the rest of the article) in an existing project you most likely don‚Äôt have a mono-repo structure (and making a refactor to achieve this kind of architecture will not be easy). An example of architecture is the following, with a repository for every platform.
To understand how to integrate KMP into existing code, give a look at my previous article: ‚ÄúIntroducing Kotlin Multiplatform in an existing project‚Äù"><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/"><meta property="og:image" content="https://www.marcogomiero.com/img/kmp-existing-projects/kmp-publish-arch.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-14T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-14T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.marcogomiero.com/img/kmp-existing-projects/kmp-publish-arch.png"><meta name=twitter:title content="How to build an XCFramework on Kotlin Multiplatform"><meta name=twitter:description content="When you start integrating Kotlin Multiplatform (I‚Äôll call it KMP in the rest of the article) in an existing project you most likely don‚Äôt have a mono-repo structure (and making a refactor to achieve this kind of architecture will not be easy). An example of architecture is the following, with a repository for every platform.
To understand how to integrate KMP into existing code, give a look at my previous article: ‚ÄúIntroducing Kotlin Multiplatform in an existing project‚Äù"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.marcogomiero.com/posts/"},{"@type":"ListItem","position":3,"name":"How to build an XCFramework on Kotlin Multiplatform","item":"https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to build an XCFramework on Kotlin Multiplatform","name":"How to build an XCFramework on Kotlin Multiplatform","description":"When you start integrating Kotlin Multiplatform (I‚Äôll call it KMP in the rest of the article) in an existing project you most likely don‚Äôt have a mono-repo structure (and making a refactor to achieve this kind of architecture will not be easy). An example of architecture is the following, with a repository for every platform.\nTo understand how to integrate KMP into existing code, give a look at my previous article: ‚ÄúIntroducing Kotlin Multiplatform in an existing project‚Äù","keywords":[],"articleBody":" When you start integrating Kotlin Multiplatform (I‚Äôll call it KMP in the rest of the article) in an existing project you most likely don‚Äôt have a mono-repo structure (and making a refactor to achieve this kind of architecture will not be easy). An example of architecture is the following, with a repository for every platform.\nTo understand how to integrate KMP into existing code, give a look at my previous article: ‚ÄúIntroducing Kotlin Multiplatform in an existing project‚Äù\nKMP code will be served as a library: the compiler generates a .jar for the JVM, a .aar for Android, and a Framework for iOS.\nFor iOS, the Framework will be a FatFramework, because it is necessary to have in the same package the architecture for the simulator and the real device. In a past article, I‚Äôve explained how to generate a FatFramework and how to distribute it in a CocoaPod repo. It is possible with some Gradle tasks or with the KMP FatFramework Cocoa Gradle plugin that I wrote.\nHowever, FatFrameworks seems not to be the ‚Äúcurrent state of the art‚Äù solution to distribute multiple architectures at the same time. In fact, Apple during WWDC 2019 has introduced XCFramework, a binary that can contain multiple platform-specific variants (even for iOS and macOS at the same time).\nApple is pushing toward the use of XCFrameworks and you could encounter errors like the following one that happened to Sam Edwards.\nIt WAS working... now... üò≠ü§î Any ideas @marcoGomier? pic.twitter.com/K8f5bPO44P\n‚Äî mastodon.social/@handstandsam (@HandstandSam) June 11, 2021 Sam followed the same approach I‚Äôve followed but I never encounter the error! And the reason could be the following:\nfor those who really can't use xcframework, usage of VALIDATE_WORKSPACE = NO, on Build Settings, can be leverage. just make sure to set to YES and then NO so that xcode persists the value onto pbxproj\n‚Äî Jo√£o Gon√ßalves (@Chuckytuh) June 12, 2021 Unfortunately, there isn‚Äôt native support for XCFrameworks on Kotlin Multiplatform yet (it should come hopefully with Kotlin 1.5.30) and to generate an XCFramework, you have to create manually an XCFramework starting from the different frameworks built by KMP.\nFrom Kotlin 1.5.30, XCFrameworks are officialy supported. I wrote another article on how to replace the custom gradle tasks, that are showcased below, with the official ones. Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30.\nxcrun xcodebuild -create-xcframework \\ -framework /path/to/device.framework \\ -debug-symbols /path/to/device.DSYM \\ -framework /path/to/simulator.framework \\ -debug-symbols /path/to/simulator.DSYM \\ -output frameworkName.xcframework This is a boring thing to do manually every time, so there‚Äôs room for some scripting.\nThe first step is building a custom Gradle task, named buildDebugXCFramework to build a debug version of the XCFramework.\nval libName = ‚ÄúLibraryName‚Äù register(\"buildDebugXCFramework\", Exec::class.java) { description = \"Create a Debug XCFramework\" dependsOn(\"link${libName}DebugFrameworkIosArm64\") dependsOn(\"link${libName}DebugFrameworkIosX64\") val arm64FrameworkPath = \"$rootDir/build/bin/iosArm64/${libName}DebugFramework/${libName}.framework\" val arm64DebugSymbolsPath = \"$rootDir/build/bin/iosArm64/${libName}DebugFramework/${libName}.framework.dSYM\" val x64FrameworkPath = \"$rootDir/build/bin/iosX64/${libName}DebugFramework/${libName}.framework\" val x64DebugSymbolsPath = \"$rootDir/build/bin/iosX64/${libName}DebugFramework/${libName}.framework.dSYM\" val xcFrameworkDest = File(\"$rootDir/../kmp-xcframework-dest/$libName.xcframework\") executable = \"xcodebuild\" args(mutableListOf().apply { add(\"-create-xcframework\") add(\"-output\") add(xcFrameworkDest.path) // Real Device add(\"-framework\") add(arm64FrameworkPath) add(\"-debug-symbols\") add(arm64DebugSymbolsPath) // Simulator add(\"-framework\") add(x64FrameworkPath) add(\"-debug-symbols\") add(x64DebugSymbolsPath) }) doFirst { xcFrameworkDest.deleteRecursively() } } The first thing to do is building the frameworks for the required architectures: arm64 for the ‚Äúreal‚Äù device and X64 for the simulator. The build process can be triggered with the link task, in this case for the Debug variant of the framework.\ndependsOn(\"link${libName}DebugFrameworkIosArm64\") dependsOn(\"link${libName}DebugFrameworkIosX64\") The frameworks will be saved in the build/bin folder of the project:\nbuild ‚îî‚îÄ‚îÄ bin ‚îú‚îÄ‚îÄ iosArm64 ‚îÇ¬†‚îú‚îÄ‚îÄ LibraryNameDebugFramework ‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ LibraryName.framework ‚îÇ¬†‚îÇ¬†‚îî‚îÄ‚îÄ LibraryName.framework.dSYM ‚îî‚îÄ‚îÄ iosX64 ‚îú‚îÄ‚îÄ LibraryNameDebugFramework ‚îÇ¬†‚îú‚îÄ‚îÄ LibraryName.framework ‚îÇ¬†‚îî‚îÄ‚îÄ LibraryName.framework.dSYM At this point, it is necessary to provide to the task all the parameters required by xcodebuild command.\nexecutable = \"xcodebuild\" args(mutableListOf().apply { add(\"-create-xcframework\") add(\"-output\") ‚Ä¶ } Before executing the task, it‚Äôs better to clear the files inside the XCFramework destination, because the xcodebuild command will not replace the old artifacts.\ndoFirst { xcFrameworkDest.deleteRecursively() } And that‚Äôs it! Now there is a Debug XCFramework ready to be distributed.\nThe steps required to build a Release version of the framework are very similar.\nFirst of all, it is necessary to build the frameworks for both the required architectures:\ndependsOn(\"link${libName}ReleaseFrameworkIosArm64\") dependsOn(\"link${libName}ReleaseFrameworkIosX64\") The frameworks will be saved in the build/bin folder like for the Debug version:\nbuild ‚îî‚îÄ‚îÄ bin ‚îú‚îÄ‚îÄ iosArm64 ‚îÇ¬†‚îî‚îÄ‚îÄ LibraryNameReleaseFramework ‚îÇ¬†‚îú‚îÄ‚îÄ LibraryName.framework ‚îÇ¬†‚îî‚îÄ‚îÄ LibraryName.framework.dSYM ‚îî‚îÄ‚îÄ iosX64 ‚îî‚îÄ‚îÄ LibraryNameReleaseFramework ‚îú‚îÄ‚îÄ LibraryName.framework ‚îî‚îÄ‚îÄ LibraryName.framework.dSYM The parameters for the xcodebuild command will be the same, except for the path.\nregister(\"buildReleaseXCFramework\", Exec::class.java) { description = \"Create a Release XCFramework\" dependsOn(\"link${libName}ReleaseFrameworkIosArm64\") dependsOn(\"link${libName}ReleaseFrameworkIosX64\") val arm64FrameworkPath = \"$rootDir/build/bin/iosArm64/${libName}ReleaseFramework/${libName}.framework\" val arm64DebugSymbolsPath = \"$rootDir/build/bin/iosArm64/${libName}ReleaseFramework/${libName}.framework.dSYM\" val x64FrameworkPath = \"$rootDir/build/bin/iosX64/${libName}ReleaseFramework/${libName}.framework\" val x64DebugSymbolsPath = \"$rootDir/build/bin/iosX64/${libName}ReleaseFramework/${libName}.framework.dSYM\" val xcFrameworkDest = File(\"$rootDir/../kmp-xcframework-dest/$libName.xcframework\") executable = \"xcodebuild\" args(mutableListOf().apply { add(\"-create-xcframework\") add(\"-output\") add(xcFrameworkDest.path) // Real Device add(\"-framework\") add(arm64FrameworkPath) add(\"-debug-symbols\") add(arm64DebugSymbolsPath) // Simulator add(\"-framework\") add(x64FrameworkPath) add(\"-debug-symbols\") add(x64DebugSymbolsPath) }) doFirst { xcFrameworkDest.deleteRecursively() } } The newly built XCFramework can now be distributed. The distribution can be archived in different ways: for example in a CocoaPods repository, in the Swift Package Manager or with Carthage. Since I‚Äôm familiar with CocoaPods, that‚Äôs what I‚Äôm using.\nTo make the publishing process as streamlined as possible, I‚Äôve written a bunch of Gradle tasks to automatically build and publish through git the Debug and Release version of the XCFramework. For the details and to understand how the task works, I suggest you give a look at this article that I wrote a few months ago.\nPublish Debug Version:\nregister(\"publishDevFramework\") { description = \"Publish Debug XCFramework to the Cocoa Repo\" project.exec { workingDir = File(\"$rootDir/../kmp-xcframework-dest\") commandLine(\"git\", \"checkout\", \"develop\").standardOutput } dependsOn(\"buildDebugXCFramework\") doLast { val dir = File(\"/.podspec\") val tempFile = File(\"/.podspec.new\") val reader = dir.bufferedReader() val writer = tempFile.bufferedWriter() var currentLine: String? while (reader.readLine().also { currLine -\u003e currentLine = currLine } != null) { if (currentLine?.startsWith(\"s.version\") == true) { writer.write(\"s.version = \\\"${libVersionName}\\\"\" + System.lineSeparator()) } else { writer.write(currentLine + System.lineSeparator()) } } writer.close() reader.close() val successful = tempFile.renameTo(dir) if (successful) { val dateFormatter = SimpleDateFormat(\"dd/MM/yyyy - HH:mm\", Locale.getDefault()) project.exec { workingDir = File(\"\") commandLine(\"git\", \"commit\", \"-a\", \"-m\", \"\\\"New dev release: ${libVersionName}-${dateFormatter.format(Date())}\\\"\").standardOutput } project.exec { workingDir = File(\"\") commandLine(\"git\", \"push\", \"origin\", \"develop\").standardOutput } } } } Publish Release Version:\nregister(\"publishFramework\") { description = \"Publish Release XCFramework to the Cocoa Repo\" project.exec { workingDir = File(\"$rootDir/../kmp-xcframework-dest\") commandLine(\"git\", \"checkout\", \"master\").standardOutput } dependsOn(\"buildReleaseXCFramework\") doLast { val dir = File(\"/.podspec\") val tempFile = File(\"/.podspec.new\") val reader = dir.bufferedReader() val writer = tempFile.bufferedWriter() var currentLine: String? while (reader.readLine().also { currLine -\u003e currentLine = currLine } != null) { if (currentLine?.startsWith(\"s.version\") == true) { writer.write(\"s.version = \\\"${libVersionName}\\\"\" + System.lineSeparator()) } else { writer.write(currentLine + System.lineSeparator()) } } writer.close() reader.close() val successful = tempFile.renameTo(dir) if (successful) { project.exec { workingDir = File(\"\") commandLine(\"git\", \"commit\", \"-a\", \"-m\", \"\\\"New release: ${libVersionName}\\\"\").standardOutput } project.exec { workingDir = File(\"\") commandLine(\"git\", \"tag\", libVersionName).standardOutput } project.exec { workingDir = File(\"\") commandLine(\"git\", \"push\", \"origin\", \"master\", \"--tags\").standardOutput } } } } All the tasks mentioned in the article are available in the KMP FatFramework Cocoa Gradle plugin that I wrote. The support for XCFrameworks has been added since version 0.2.1.\nOn GitHub, I‚Äôve published a sample project to showcase the usage of the task. In the pre-kotlin-1.5.30 branch the tasks are manually added in the build.gradle.kts file. In the pre-kotlin-1.5.30-with-plugin branch instead, the KMP FatFramework Cocoa plugin is used.\nYou can follow me on Twitter to know when there will be some update of the plugin (and this is a spoiler! :))\n// Thanks to Sam Edwards for mentioning my article and ‚Äútrigger‚Äù the creation of this one. ","wordCount":"1235","inLanguage":"en","image":"https://www.marcogomiero.com/img/kmp-existing-projects/kmp-publish-arch.png","datePublished":"2021-07-14T00:00:00Z","dateModified":"2021-07-14T00:00:00Z","author":{"@type":"Person","name":"Marco Gomiero"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.marcogomiero.com/posts/2021/build-xcframework-kmp/"},"publisher":{"@type":"Organization","name":"Marco Gomiero","logo":{"@type":"ImageObject","url":"https://www.marcogomiero.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.marcogomiero.com accesskey=h title="Marco Gomiero (Alt + H)">Marco Gomiero</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.marcogomiero.com/posts/ title=Write><span>Write</span></a></li><li><a href=https://www.marcogomiero.com/talks/ title=Speak><span>Speak</span></a></li><li><a href=https://www.marcogomiero.com/projects/ title=Build><span>Build</span></a></li><li><a href=https://www.marcogomiero.com/about-me/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>How to build an XCFramework on Kotlin Multiplatform</h1><div class=post-meta style=margin-top:16px><span title='2021-07-14 00:00:00 +0000 UTC'>14 July 2021</span>&nbsp;¬∑&nbsp;6 min</div></header><div class=post-content><div id=banner style=overflow:hidden;justify-content:space-around><div style=display:inline-block;margin-right:10px><a href=https://androidweekly.net/issues/issue-475><img style=margin:0 src=https://androidweekly.net/issues/issue-475/badge></a></div><div style=display:inline-block><a href=https://mailchi.mp/kotlinweekly/kotlin-weekly-259><img style=margin:0 src=https://img.shields.io/badge/Featured%20in%20kotlinweekly.net-Issue%20%23259-%237874b4></a></div></div><p>When you start integrating Kotlin Multiplatform (I‚Äôll call it KMP in the rest of the article) in an existing project you most likely don‚Äôt have a mono-repo structure (and making a refactor to achieve this kind of architecture will not be easy). An example of architecture is the following, with a repository for every platform.</p><figure><a href=/img/kmp-existing-project/kmp-publish-arch.png><img loading=lazy src=/img/kmp-existing-projects/kmp-publish-arch.png></a></figure><blockquote><p>To understand how to integrate KMP into existing code, give a look at my previous article: <a href=https://www.marcogomiero.com/posts/2021/kmp-existing-project/>‚ÄúIntroducing Kotlin Multiplatform in an existing project‚Äù</a></p></blockquote><p>KMP code will be served as a library: the compiler generates a .jar for the JVM, a .aar for Android, and a Framework for iOS.</p><p>For iOS, the Framework will be a FatFramework, because it is necessary to have in the same package the architecture for the simulator and the real device. In <a href=https://www.marcogomiero.com/posts/2021/kmp-existing-project/>a past article</a>, I‚Äôve explained how to generate a FatFramework and how to distribute it in a CocoaPod repo. It is possible with some Gradle tasks or with the <a href=https://github.com/prof18/kmp-fatframework-cocoa>KMP FatFramework Cocoa</a> Gradle plugin that I wrote.</p><p>However, FatFrameworks seems not to be the ‚Äúcurrent state of the art‚Äù solution to distribute multiple architectures at the same time. In fact, Apple during <a href=https://developer.apple.com/videos/play/wwdc2019/416/>WWDC 2019</a> has introduced <a href=https://help.apple.com/xcode/mac/11.4/#/dev544efab96>XCFramework</a>, a binary that can contain multiple platform-specific variants (even for iOS and macOS at the same time).</p><p>Apple is pushing toward the use of XCFrameworks and you could encounter errors like the following one that happened to <a href=https://twitter.com/handstandsam>Sam Edwards</a>.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>It WAS working... now... üò≠ü§î<br><br>Any ideas <a href="https://twitter.com/marcoGomier?ref_src=twsrc%5Etfw">@marcoGomier</a>? <a href=https://t.co/K8f5bPO44P>pic.twitter.com/K8f5bPO44P</a></p>&mdash; mastodon.social/@handstandsam (@HandstandSam) <a href="https://twitter.com/HandstandSam/status/1403456462689550345?ref_src=twsrc%5Etfw">June 11, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>Sam <a href=https://handstandsam.com/2021/06/11/kotlin-multiplatform-building-a-fat-ios-framework-for-iosarm64-and-iosx64/>followed the same approach</a> I‚Äôve followed but I never encounter the error! And the reason could be the following:</p><blockquote class=twitter-tweet><p lang=en dir=ltr>for those who really can't use xcframework, usage of VALIDATE_WORKSPACE = NO, on Build Settings, can be leverage. just make sure to set to YES and then NO so that xcode persists the value onto pbxproj</p>&mdash; Jo√£o Gon√ßalves (@Chuckytuh) <a href="https://twitter.com/Chuckytuh/status/1403673057487687682?ref_src=twsrc%5Etfw">June 12, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>Unfortunately, there isn‚Äôt native support for XCFrameworks on Kotlin Multiplatform yet (it should come hopefully with Kotlin 1.5.30) and to generate an XCFramework, you have to create manually an XCFramework starting from the different frameworks built by KMP.</p><blockquote><p>From Kotlin 1.5.30, XCFrameworks are officialy supported. I wrote another article on how to replace the custom gradle tasks, that are showcased below, with the official ones. <a href=https://www.marcogomiero.com/posts/2021/kmp-xcframework-official-support.md/>Building an XCFramework on Kotlin Multiplatform from Kotlin 1.5.30</a>.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xcrun xcodebuild -create-xcframework <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -framework /path/to/device.framework <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -debug-symbols /path/to/device.DSYM <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -framework /path/to/simulator.framework <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -debug-symbols /path/to/simulator.DSYM <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -output frameworkName.xcframework
</span></span></code></pre></div><p>This is a boring thing to do manually every time, so there‚Äôs room for some scripting.</p><p>The first step is building a custom Gradle task, named <code>buildDebugXCFramework</code> to build a debug version of the XCFramework.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> libName = <span style=color:#960050;background-color:#1e0010>‚Äú</span>LibraryName<span style=color:#960050;background-color:#1e0010>‚Äù</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>register(<span style=color:#e6db74>&#34;buildDebugXCFramework&#34;</span>, Exec<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>    description = <span style=color:#e6db74>&#34;Create a Debug XCFramework&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFrameworkIosArm64&#34;</span>)
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFrameworkIosX64&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> arm64FrameworkPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosArm64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> arm64DebugSymbolsPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosArm64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework.dSYM&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> x64FrameworkPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosX64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> x64DebugSymbolsPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosX64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework.dSYM&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> xcFrameworkDest = File(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/../kmp-xcframework-dest/</span><span style=color:#e6db74>$libName</span><span style=color:#e6db74>.xcframework&#34;</span>)
</span></span><span style=display:flex><span>    executable = <span style=color:#e6db74>&#34;xcodebuild&#34;</span>
</span></span><span style=display:flex><span>    args(mutableListOf&lt;String&gt;().apply {
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-create-xcframework&#34;</span>)
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-output&#34;</span>)
</span></span><span style=display:flex><span>        add(xcFrameworkDest.path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Real Device
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        add(<span style=color:#e6db74>&#34;-framework&#34;</span>)
</span></span><span style=display:flex><span>        add(arm64FrameworkPath)
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-debug-symbols&#34;</span>)
</span></span><span style=display:flex><span>        add(arm64DebugSymbolsPath)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Simulator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        add(<span style=color:#e6db74>&#34;-framework&#34;</span>)
</span></span><span style=display:flex><span>        add(x64FrameworkPath)
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-debug-symbols&#34;</span>)
</span></span><span style=display:flex><span>        add(x64DebugSymbolsPath)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    doFirst {
</span></span><span style=display:flex><span>        xcFrameworkDest.deleteRecursively()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The first thing to do is building the frameworks for the required architectures: arm64 for the ‚Äúreal‚Äù device and X64 for the simulator. The build process can be triggered with the <code>link</code> task, in this case for the <code>Debug</code> variant of the framework.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFrameworkIosArm64&#34;</span>)
</span></span><span style=display:flex><span>dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>DebugFrameworkIosX64&#34;</span>)
</span></span></code></pre></div><p>The frameworks will be saved in the <code>build/bin</code> folder of the project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>build
</span></span><span style=display:flex><span>‚îî‚îÄ‚îÄ bin
</span></span><span style=display:flex><span>    ‚îú‚îÄ‚îÄ iosArm64
</span></span><span style=display:flex><span>    ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ LibraryNameDebugFramework
</span></span><span style=display:flex><span>    ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ LibraryName.framework
</span></span><span style=display:flex><span>    ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ LibraryName.framework.dSYM
</span></span><span style=display:flex><span>    ‚îî‚îÄ‚îÄ iosX64
</span></span><span style=display:flex><span>        ‚îú‚îÄ‚îÄ LibraryNameDebugFramework
</span></span><span style=display:flex><span>        ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ LibraryName.framework
</span></span><span style=display:flex><span>        ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ LibraryName.framework.dSYM
</span></span></code></pre></div><p>At this point, it is necessary to provide to the task all the parameters required by <code>xcodebuild</code> command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>executable = <span style=color:#e6db74>&#34;xcodebuild&#34;</span>
</span></span><span style=display:flex><span>args(mutableListOf&lt;String&gt;().apply {
</span></span><span style=display:flex><span>    add(<span style=color:#e6db74>&#34;-create-xcframework&#34;</span>)
</span></span><span style=display:flex><span>    add(<span style=color:#e6db74>&#34;-output&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>‚Ä¶</span>
</span></span><span style=display:flex><span>}    
</span></span></code></pre></div><p>Before executing the task, it‚Äôs better to clear the files inside the XCFramework destination, because the <code>xcodebuild</code> command will not replace the old artifacts.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>doFirst {
</span></span><span style=display:flex><span>    xcFrameworkDest.deleteRecursively()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And that‚Äôs it! Now there is a Debug XCFramework ready to be distributed.</p><p>The steps required to build a Release version of the framework are very similar.</p><p>First of all, it is necessary to build the frameworks for both the required architectures:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span> dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFrameworkIosArm64&#34;</span>)
</span></span><span style=display:flex><span> dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFrameworkIosX64&#34;</span>)
</span></span></code></pre></div><p>The frameworks will be saved in the <code>build/bin</code> folder like for the Debug version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>build
</span></span><span style=display:flex><span>‚îî‚îÄ‚îÄ bin
</span></span><span style=display:flex><span>    ‚îú‚îÄ‚îÄ iosArm64
</span></span><span style=display:flex><span>    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ LibraryNameReleaseFramework
</span></span><span style=display:flex><span>    ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ LibraryName.framework
</span></span><span style=display:flex><span>    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ LibraryName.framework.dSYM
</span></span><span style=display:flex><span>    ‚îî‚îÄ‚îÄ iosX64
</span></span><span style=display:flex><span>        ‚îî‚îÄ‚îÄ LibraryNameReleaseFramework
</span></span><span style=display:flex><span>            ‚îú‚îÄ‚îÄ LibraryName.framework
</span></span><span style=display:flex><span>            ‚îî‚îÄ‚îÄ LibraryName.framework.dSYM
</span></span></code></pre></div><p>The parameters for the <code>xcodebuild</code> command will be the same, except for the path.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span> register(<span style=color:#e6db74>&#34;buildReleaseXCFramework&#34;</span>, Exec<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java) {
</span></span><span style=display:flex><span>    description = <span style=color:#e6db74>&#34;Create a Release XCFramework&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFrameworkIosArm64&#34;</span>)
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;link</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFrameworkIosX64&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> arm64FrameworkPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosArm64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> arm64DebugSymbolsPath =
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosArm64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework.dSYM&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> x64FrameworkPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosX64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> x64DebugSymbolsPath = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/build/bin/iosX64/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>ReleaseFramework/</span><span style=color:#e6db74>${libName}</span><span style=color:#e6db74>.framework.dSYM&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> xcFrameworkDest = File(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/../kmp-xcframework-dest/</span><span style=color:#e6db74>$libName</span><span style=color:#e6db74>.xcframework&#34;</span>)
</span></span><span style=display:flex><span>    executable = <span style=color:#e6db74>&#34;xcodebuild&#34;</span>
</span></span><span style=display:flex><span>    args(mutableListOf&lt;String&gt;().apply {
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-create-xcframework&#34;</span>)
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-output&#34;</span>)
</span></span><span style=display:flex><span>        add(xcFrameworkDest.path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Real Device
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        add(<span style=color:#e6db74>&#34;-framework&#34;</span>)
</span></span><span style=display:flex><span>        add(arm64FrameworkPath)
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-debug-symbols&#34;</span>)
</span></span><span style=display:flex><span>        add(arm64DebugSymbolsPath)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Simulator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        add(<span style=color:#e6db74>&#34;-framework&#34;</span>)
</span></span><span style=display:flex><span>        add(x64FrameworkPath)
</span></span><span style=display:flex><span>        add(<span style=color:#e6db74>&#34;-debug-symbols&#34;</span>)
</span></span><span style=display:flex><span>        add(x64DebugSymbolsPath)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    doFirst {
</span></span><span style=display:flex><span>        xcFrameworkDest.deleteRecursively()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The newly built XCFramework can now be distributed. The distribution can be archived in different ways: for example in a <em><a href=https://cocoapods.org/>CocoaPods</a></em> repository, in the <a href=https://swift.org/package-manager/>Swift Package Manager</a> or with <a href=https://github.com/Carthage/Carthage>Carthage</a>. Since I‚Äôm familiar with CocoaPods, that‚Äôs what I‚Äôm using.</p><p>To make the publishing process as streamlined as possible, I‚Äôve written a bunch of Gradle tasks to automatically build and publish through git the Debug and Release version of the XCFramework. For the details and to understand how the task works, I suggest you give a look at <a href=https://www.marcogomiero.com/posts/2021/kmp-existing-project/>this article</a> that I wrote a few months ago.</p><p><strong>Publish Debug Version</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>register(<span style=color:#e6db74>&#34;publishDevFramework&#34;</span>) {
</span></span><span style=display:flex><span>    description = <span style=color:#e6db74>&#34;Publish Debug XCFramework to the Cocoa Repo&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    project.exec {
</span></span><span style=display:flex><span>        workingDir = File(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/../kmp-xcframework-dest&#34;</span>)
</span></span><span style=display:flex><span>        commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;checkout&#34;</span>, <span style=color:#e6db74>&#34;develop&#34;</span>).standardOutput
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;buildDebugXCFramework&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    doLast {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> dir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;/&lt;your-library-name&gt;.podspec&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> tempFile = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;/&lt;your-library-name&gt;.podspec.new&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> reader = dir.bufferedReader()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> writer = tempFile.bufferedWriter()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> currentLine: String?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (reader.readLine().also { currLine <span style=color:#f92672>-&gt;</span> currentLine = currLine } <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (currentLine<span style=color:#f92672>?.</span>startsWith(<span style=color:#e6db74>&#34;s.version&#34;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>                writer.write(<span style=color:#e6db74>&#34;s.version       = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>${libVersionName}</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> + System.lineSeparator())
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                writer.write(currentLine + System.lineSeparator())
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        writer.close()
</span></span><span style=display:flex><span>        reader.close()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> successful = tempFile.renameTo(dir)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (successful) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> dateFormatter = SimpleDateFormat(<span style=color:#e6db74>&#34;dd/MM/yyyy - HH:mm&#34;</span>, Locale.getDefault())
</span></span><span style=display:flex><span>            project.exec {
</span></span><span style=display:flex><span>                workingDir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;&#34;</span>)
</span></span><span style=display:flex><span>                commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;commit&#34;</span>, <span style=color:#e6db74>&#34;-a&#34;</span>, <span style=color:#e6db74>&#34;-m&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>New dev release: </span><span style=color:#e6db74>${libVersionName}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${dateFormatter.format(Date())}</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>).standardOutput
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            project.exec {
</span></span><span style=display:flex><span>                workingDir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;&#34;</span>)
</span></span><span style=display:flex><span>                commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;push&#34;</span>, <span style=color:#e6db74>&#34;origin&#34;</span>, <span style=color:#e6db74>&#34;develop&#34;</span>).standardOutput
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Publish Release Version</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>register(<span style=color:#e6db74>&#34;publishFramework&#34;</span>) {
</span></span><span style=display:flex><span>    description = <span style=color:#e6db74>&#34;Publish Release XCFramework to the Cocoa Repo&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    project.exec {
</span></span><span style=display:flex><span>        workingDir = File(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$rootDir</span><span style=color:#e6db74>/../kmp-xcframework-dest&#34;</span>)
</span></span><span style=display:flex><span>        commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;checkout&#34;</span>, <span style=color:#e6db74>&#34;master&#34;</span>).standardOutput
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    dependsOn(<span style=color:#e6db74>&#34;buildReleaseXCFramework&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    doLast {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> dir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;/&lt;your-library-name&gt;.podspec&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> tempFile = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;/&lt;your-library-name&gt;.podspec.new&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> reader = dir.bufferedReader()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> writer = tempFile.bufferedWriter()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> currentLine: String?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (reader.readLine().also { currLine <span style=color:#f92672>-&gt;</span> currentLine = currLine } <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (currentLine<span style=color:#f92672>?.</span>startsWith(<span style=color:#e6db74>&#34;s.version&#34;</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>                writer.write(<span style=color:#e6db74>&#34;s.version       = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>${libVersionName}</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> + System.lineSeparator())
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                writer.write(currentLine + System.lineSeparator())
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        writer.close()
</span></span><span style=display:flex><span>        reader.close()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> successful = tempFile.renameTo(dir)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (successful) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            project.exec {
</span></span><span style=display:flex><span>                workingDir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;&#34;</span>)
</span></span><span style=display:flex><span>                commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;commit&#34;</span>, <span style=color:#e6db74>&#34;-a&#34;</span>, <span style=color:#e6db74>&#34;-m&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>New release: </span><span style=color:#e6db74>${libVersionName}</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>).standardOutput
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            project.exec {
</span></span><span style=display:flex><span>                workingDir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;&#34;</span>)
</span></span><span style=display:flex><span>                commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;tag&#34;</span>, libVersionName).standardOutput
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            project.exec {
</span></span><span style=display:flex><span>                workingDir = File(<span style=color:#e6db74>&#34;&lt;framework-destination&gt;&#34;</span>)
</span></span><span style=display:flex><span>                commandLine(<span style=color:#e6db74>&#34;git&#34;</span>, <span style=color:#e6db74>&#34;push&#34;</span>, <span style=color:#e6db74>&#34;origin&#34;</span>, <span style=color:#e6db74>&#34;master&#34;</span>, <span style=color:#e6db74>&#34;--tags&#34;</span>).standardOutput
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>All the tasks mentioned in the article are available in the <a href=https://github.com/prof18/kmp-fatframework-cocoa>KMP FatFramework Cocoa Gradle plugin</a> that I wrote. The support for XCFrameworks has been added since <a href=https://github.com/prof18/kmp-fatframework-cocoa/releases/tag/0.2.1>version 0.2.1</a>.</p><p>On GitHub, I‚Äôve published <a href=https://github.com/prof18/kmp-xcframework-sample>a sample project</a> to showcase the usage of the task. In the <a href=https://github.com/prof18/kmp-xcframework-sample/tree/pre-kotlin-1.5.30>pre-kotlin-1.5.30</a> branch the tasks are manually added in the <a href=https://github.com/prof18/kmp-xcframework-sample/blob/pre-kotlin-1.5.30/build.gradle.kts>build.gradle.kts</a> file. In the <a href=https://github.com/prof18/kmp-xcframework-sample/tree/pre-kotlin-1.5.30-with-plugin>pre-kotlin-1.5.30-with-plugin</a> branch instead, the KMP FatFramework Cocoa plugin is used.</p><p>You can follow me on <a href=https://twitter.com/marcoGomier>Twitter</a> to know when there will be some update of the plugin (and this is a spoiler! :))</p><p style=font-size:12px>// Thanks to <a href=https://twitter.com/handstandsam>Sam Edwards</a> for mentioning my article and ‚Äútrigger‚Äù the creation of this one.</p></div><div class=article-footer><div class=post-content>To stay up to date with my writing and my projects, follow me on <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>