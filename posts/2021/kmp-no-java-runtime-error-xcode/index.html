<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>How to fix the "Unable to locate a Java Runtime" error on Xcode with Kotlin Multiplatform - Marco Gomiero</title><meta name=Description content="Software Engineer · Google Developer Expert for Kotlin"><meta property="og:title" content="How to fix the &#34;Unable to locate a Java Runtime&#34; error on Xcode with Kotlin Multiplatform"><meta property="og:description" content="A couple of days ago I opened my Kotlin Multiplatform pet project MoneyFlow on a different machine than usual. When I tried to run the app on the iOS simulator on Xcode, the build failed with a very strange error: &ldquo;The operation couldn&rsquo;t be completed. Unable to locate a Java Runtime&rdquo;.
  This was a very strange issue because the JDK is installed and everything is working on the command line and Android Studio/IntelliJ."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2021/kmp-no-java-runtime-error-xcode/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to fix the &#34;Unable to locate a Java Runtime&#34; error on Xcode with Kotlin Multiplatform"><meta name=twitter:description content="A couple of days ago I opened my Kotlin Multiplatform pet project MoneyFlow on a different machine than usual. When I tried to run the app on the iOS simulator on Xcode, the build failed with a very strange error: &ldquo;The operation couldn&rsquo;t be completed. Unable to locate a Java Runtime&rdquo;.
  This was a very strange issue because the JDK is installed and everything is working on the command line and Android Studio/IntelliJ."><meta name=application-name content="Marco Gomiero"><meta name=apple-mobile-web-app-title content="Marco Gomiero"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.marcogomiero.com/posts/2021/kmp-no-java-runtime-error-xcode/><link rel=prev href=https://www.marcogomiero.com/posts/2021/ktor-in-memory-db-testing/><link rel=next href=https://www.marcogomiero.com/posts/2022/ktor-migration-liquibase/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How to fix the \"Unable to locate a Java Runtime\" error on Xcode with Kotlin Multiplatform","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.marcogomiero.com\/posts\/2021\/kmp-no-java-runtime-error-xcode\/"},"image":["https:\/\/www.marcogomiero.com\/images\/Apple-Devices-Preview.png"],"genre":"posts","wordcount":313,"url":"https:\/\/www.marcogomiero.com\/posts\/2021\/kmp-no-java-runtime-error-xcode\/","datePublished":"2021-12-27T00:00:00+00:00","dateModified":"2021-12-27T00:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Marco Gomiero"},"author":{"@type":"Person","name":"Marco Gomiero"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Marco Gomiero">Marco Gomiero</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts>Posts </a><a class=menu-item href=/talks>Talks </a><a class=menu-item href=/projects>Projects </a><a class=menu-item href=/about-me>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Marco Gomiero">Marco Gomiero</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts title>Posts</a><a class=menu-item href=/talks title>Talks</a><a class=menu-item href=/projects title>Projects</a><a class=menu-item href=/about-me title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel=stylesheet><main class=main><div class=container><article class="page single"><h1 class=single-title>How to fix the "Unable to locate a Java Runtime" error on Xcode with Kotlin Multiplatform</h1><br><div class=post-meta><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="27 Dec 2021">27 Dec 2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;313 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div></div><br><div class=content id=content><div id=banner style=overflow:hidden;justify-content:space-around><div style=display:inline-block;margin-right:10px><a href=https://androidweekly.net/issues/issue-499><img style=margin:0 src=https://androidweekly.net/issues/issue-499/badge></a></div></div><p>A couple of days ago I opened my Kotlin Multiplatform pet project <a href=https://github.com/prof18/MoneyFlow target=_blank rel="noopener noreffer">MoneyFlow</a> on a different machine than usual. When I tried to run the app on the iOS simulator on Xcode, the build failed with a very strange error: &ldquo;The operation couldn&rsquo;t be completed. Unable to locate a Java Runtime&rdquo;.</p><figure><a href=/img/xcode-jvm-runtime/xcode-java-runtime.jpeg><img src=/img/xcode-jvm-runtime/xcode-java-runtime.jpeg></a></figure><p>This was a very strange issue because the JDK is installed and everything is working on the command line and Android Studio/IntelliJ.</p><p>After doing some research, I found out in <a href="https://youtrack.jetbrains.com/issue/KT-50474#focus=Comments-27-5673712.0-0" target=_blank rel="noopener noreffer">a comment of a Youtrack issue</a> that Xcode is taking the JDK version from <code>/usr/libexec/java_home</code>. So I tried to run <code>/usr/libexec/java_home</code> in the command line and I got the same error: <code>The operation couldn’t be completed. Unable to locate a Java Runtime.</code> Still strange.</p><p>I usually install the JDK manually with Homebrew, but for this time I decided to give <a href=https://sdkman.io/usage target=_blank rel="noopener noreffer"><code>sdkman</code></a> a try. And that was the problem because <code>sdkman</code> “doesn’t expose” the JDK version to <code>/usr/libexec/java_home</code>.</p><p>So I went back to the old and good manual way. Since the AdoptOpenJDK tap <a href=https://github.com/AdoptOpenJDK/homebrew-openjdk#-deprecation-notice- target=_blank rel="noopener noreffer">is deprecated</a>, I tried the <a href=https://formulae.brew.sh/cask/temurin target=_blank rel="noopener noreffer">Temurin one</a> and installed Java 11 and Java 8.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>brew tap homebrew/cask-versions

brew install --cask temurin8

brew install --cask temurin11
</code></pre></td></tr></table></div></div><p>Then I adapted a couple of alias (to add on <code>.zshrc</code> or <code>.bash_profile</code> file) that I found out <a href=https://www.yippeecode.com/topics/upgrade-to-openjdk-temurin-using-homebrew/ target=_blank rel="noopener noreffer">in this article</a> to help me switch easily between Java 11 and Java 8, whenever I need.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>JAVA_11_HOME</span><span class=o>=</span>/Library/Java/JavaVirtualMachines/temurin-11.jdk/Contents/Home
<span class=nb>export</span> <span class=nv>JAVA_8_HOME</span><span class=o>=</span>/Library/Java/JavaVirtualMachines/temurin-8.jdk/Contents/Home

<span class=nb>alias</span> <span class=nv>java11</span><span class=o>=</span><span class=s2>&#34;export JAVA_HOME=</span><span class=nv>$JAVA_11_HOME</span><span class=s2>&#34;</span>
<span class=nb>alias</span> <span class=nv>java8</span><span class=o>=</span><span class=s2>&#34;export JAVA_HOME=</span><span class=nv>$JAVA_8_HOME</span><span class=s2>&#34;</span>

<span class=c1># Set default to Java 11</span>
java11
</code></pre></td></tr></table></div></div><p>And with the manual installation, the build started working again!</p><hr><p>Another solution, suggested by <a href=https://twitter.com/martinbonnin target=_blank rel="noopener noreffer">Martin Bonnin</a> is to explicitly set the <code>JAVA_HOME</code> inside the plist files under <code>~/Library/LaunchAgents/</code></p><blockquote class=twitter-tweet data-dnt=true><p lang=en dir=ltr>Another solution is plist files under ~/Library/LaunchAgents/. There you can set the JAVA_HOME explicitely</p>&mdash; Martin Bonnin ☀️ (@martinbonnin) <a href="https://twitter.com/martinbonnin/status/1474851964521525249?ref_src=twsrc%5Etfw">December 25, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></div><section style=width:90%;margin-left:auto;margin-right:auto;margin-top:30px;margin-bottom:30px><hr><div style=padding:25px><div class=content>To stay up to date with my writing and my projects, follow me on <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div><hr></section><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://www.marcogomiero.com/posts/2021/kmp-no-java-runtime-error-xcode/ data-title='How to fix the "Unable to locate a Java Runtime" error on Xcode with Kotlin Multiplatform' data-via=marcoGomier><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://www.marcogomiero.com/posts/2021/kmp-no-java-runtime-error-xcode/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.marcogomiero.com/posts/2021/kmp-no-java-runtime-error-xcode/ data-title='How to fix the "Unable to locate a Java Runtime" error on Xcode with Kotlin Multiplatform'><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://www.marcogomiero.com/posts/2021/kmp-no-java-runtime-error-xcode/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2021/ktor-in-memory-db-testing/ class=prev rel=prev title="How to use an in-memory database for testing on Ktor"><i class="fas fa-angle-left fa-fw"></i>How to use an in-memory database for testing on Ktor</a>
<a href=/posts/2022/ktor-migration-liquibase/ class=next rel=next title="How to handle database migrations with Liquibase on Ktor">How to handle database migrations with Liquibase on Ktor<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2017 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.marcogomiero.com/ target=_blank>Marco Gomiero</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e5},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-90975904-1 ',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-90975904-1%20" async></script></body></html>