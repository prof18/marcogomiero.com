<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions - Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions - Coming soon Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions - Coming soon Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - Coming soon It&rsquo;s been almost a year since I started working on FeedFlow, a RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><meta property="og:image" content><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><meta property="og:title" content="How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions"><meta property="og:description" content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions - Coming soon Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions - Coming soon Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - Coming soon It&rsquo;s been almost a year since I started working on FeedFlow, a RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2024/kmp-ci-android/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-30T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions"><meta name=twitter:description content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions - Coming soon Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions - Coming soon Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - Coming soon It&rsquo;s been almost a year since I started working on FeedFlow, a RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><script async src="https://www.googletagmanager.com/gtag/js?id=G-69FZ1TLE7E"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-69FZ1TLE7E",{anonymize_ip:!1})}</script><script src=https://www.marcogomiero.com/js/feather.min.js></script>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.marcogomiero.com/css/main.f2c7f60ec2d0155a784ade9b1b272143e1b8eb864a95bf75e606b49d8774389e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://www.marcogomiero.com/css/dark.2d1f13dc82ea2d94683809543a326af8a9a1f3a6c000f7b7af5d8f02a2e6ec25.css disabled></head><body><div class=content><header><div class=main><a href=https://www.marcogomiero.com><h2>Marco Gomiero</h2></a></div><nav class=navbar><a href=/posts/><span>Write</span></a>
<a href=/talks/><span>Speak</span></a>
<a href=/projects/><span>Build</span></a>
<a href=/about-me/><span>About</span></a>
| <span class=dark-mode-toggle id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.marcogomiero.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions</h1><div class=post-meta><span title='2024-04-30 00:00:00 +0000 UTC'>30 April 2024</span></div></div><section class=body><blockquote><p><strong>SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.</strong></p><ul><li>Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions</li><li>Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions - <em>Coming soon</em></li><li>Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions - <em>Coming soon</em></li><li>Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - <em>Coming soon</em></li></ul></blockquote><p>It&rsquo;s been almost a year since I started working on <a href=https://www.feedflow.dev/>FeedFlow</a>, a RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app.</p><p>To be faster and &ldquo;machine-agnostic&rdquo; with the deployments, I decided to have a CI (Continuous Integration) on GitHub Actions to quickly deploy my application to all the stores (Play Store, App Store for iOS and macOS, and on GitHub release for the macOS app).</p><p>Today, I decided to start a series of posts dedicated to setting up a CI for deploying a Kotlin Multiplatform app on Google Play, Apple App Store for iOS and macOS, and on GitHub releases for distributing a macOS app outside the App Store.</p><p>In this post, I will show how to deploy a Kotlin Multiplatform Android app on Google Play. To keep up to date, you can check out the other instances of the series in the index above or follow me on <a href=https://androiddev.social/@marcogom>Mastodon</a> or <a href=https://twitter.com/marcoGomier>Twitter</a>.</p><h2 id=triggers>Triggers</h2><p>A trigger is necessary to trigger the GitHub Action. I&rsquo;ve decided to trigger a new release when I add a tag that ends with the platform name, in this case, <code>-android</code>. So, for example, a tag would be <code>0.0.1-android</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5af78e>&#39;*-android&#39;</span>
</span></span></code></pre></div><p>In this way, I can be more flexible when making platform-independent releases.</p><h2 id=gradle-and-jdk-setup>Gradle and JDK setup</h2><p>The first part of the pipeline involves cloning the repo and setting up the infrastructure.</p><h3 id=clone-the-repository>Clone the repository</h3><p>The <code>actions/checkout</code> action can be used to clone the repository:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: actions/checkout@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span></code></pre></div><h3 id=jdk-setup>JDK Setup</h3><p>The <code>actions/setup-java</code> action can be used to set up a desired JDK. In this case, I want the <code>zulu</code> distribution and version 18.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: set up JDK
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: actions/setup-java@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>distribution</span>: <span style=color:#5af78e>&#39;zulu&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>java-version</span>: <span style=color:#ff9f43>18</span>
</span></span></code></pre></div><h3 id=gradle-setup>Gradle Setup</h3><p>The <code>gradle/actions/setup-gradle</code> action can be used to set up Gradle with its cache.</p><p>In the action, I&rsquo;m using two parameters: <code>gradle-home-cache-cleanup</code> and <code>cache-encryption-key</code>.</p><p>The <code>gradle-home-cache-cleanup</code> parameter will enable a feature that will try to delete any files in the Gradle User Home that were not used by Gradle during the GitHub Actions Workflow before saving the cache. In this way, some space can be saved. More info can be found <a href=https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#remove-unused-files-from-gradle-user-home-before-saving-to-the-cache>in the documentation</a>.</p><p>Instead, the <code>cache-encryption-key</code> parameter provides an encryption key from GitHub secrets to encrypt the configuration cache. The configuration cache might contain stored credentials and other secrets, so encrypting it before saving it on the GitHub cache is better. More info can be found <a href=https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#saving-configuration-cache-data>in the documentation</a>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: gradle/actions/setup-gradle@v3
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>gradle-home-cache-cleanup</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>cache-encryption-key</span>: ${{ secrets.GRADLE_CACHE_ENCRYPTION_KEY }}
</span></span></code></pre></div><h3 id=kotlin-native-setup>Kotlin Native setup</h3><p>When compiling a Kotlin Multiplatform project that also targets Kotlin Native, some required components will be downloaded in the <code>$USER_HOME/.konan</code> directory. Kotlin Native will also create and use some cache in this directory.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>├── .konan
</span></span><span style=display:flex><span>│   ├── cache
</span></span><span style=display:flex><span>│   ├── dependencies
</span></span><span style=display:flex><span>│   └── kotlin-native-prebuilt-macos-aarch64-1.9.23
</span></span></code></pre></div><p>Caching that directory will avoid redownloading and unnecessary computation. The <code>actions/cache</code> action can be used to do so.</p><p>The action requires a key to identify the cache uniquely; in this case, the key will be a hash of the version catalog file since the Kotlin version number is stored there:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Cache KMP tooling
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: actions/cache@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>path</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>      </span>      ~/.konan
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>key</span>: ${{ runner.os }}-v1-${{ hashFiles(&#39;*.versions.toml&#39;) }}
</span></span></code></pre></div><h2 id=setup-keystore>Setup Keystore</h2><p>Every release version of an Android app needs to be signed with a developer key. For security reasons, the <a href=https://developer.android.com/studio/publish/app-signing#certificates-keystores>keystore</a> that contains certificates and private keys can&rsquo;t be publicly released, so a good approach is to save it inside GitHub secrets.</p><p>A keystore, to be saved inside the secrets, needs to be in a &ldquo;shareable and encrypted&rdquo; format (ASCII-armor encrypted). This format can be generated with the following command and by providing a passphrase:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg -c --armor your-keystore
</span></span></code></pre></div><p>The output of the previous command can now be uploaded on GitHub secrets, alongside the passphrase and decrypted with the following command:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff5c57>echo</span> <span style=color:#5af78e>&#39;${{ secrets.KEYSTORE_FILE }}&#39;</span>&gt; release.keystore.asc
</span></span><span style=display:flex><span>gpg -d --passphrase <span style=color:#5af78e>&#39;${{ secrets.KEYSTORE_PASSPHRASE }}&#39;</span> --batch release.keystore.asc &gt; androidApp/release.keystore
</span></span></code></pre></div><p>In addition to the keystore file, some other info is required to successfully sign the app, like the key alias, the key password, and the keystore password. This info is provided in the signing configuration of the app in the <code>app/build.gradle.kts</code> file:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>signingConfigs {
</span></span><span style=display:flex><span>    create(<span style=color:#5af78e>&#34;release&#34;</span>) {
</span></span><span style=display:flex><span>        keyAlias = <span style=color:#ff6ac1>..</span>
</span></span><span style=display:flex><span>        keyPassword = <span style=color:#ff6ac1>..</span>
</span></span><span style=display:flex><span>        storeFile = <span style=color:#ff6ac1>..</span>
</span></span><span style=display:flex><span>        storePassword = <span style=color:#ff6ac1>..</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>keyAlias</code>, <code>keyPassword</code>, and <code>storePassword</code> can be saved in the GitHub secrets and provided to Gradle through a <code>properties</code> file that the GitHub Action will create:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>val</span> local = Properties()
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> localProperties: File = rootProject.<span style=color:#ff6ac1>file</span>(<span style=color:#5af78e>&#34;keystore.properties&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>if</span> (localProperties.exists()) {
</span></span><span style=display:flex><span>    localProperties.inputStream().use { local.load(<span style=color:#ff6ac1>it</span>) }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>signingConfigs {
</span></span><span style=display:flex><span>    create(<span style=color:#5af78e>&#34;release&#34;</span>) {
</span></span><span style=display:flex><span>        keyAlias = local.getProperty(<span style=color:#5af78e>&#34;keyAlias&#34;</span>)
</span></span><span style=display:flex><span>        keyPassword = local.getProperty(<span style=color:#5af78e>&#34;keyPassword&#34;</span>)
</span></span><span style=display:flex><span>        storeFile = <span style=color:#ff6ac1>file</span>(local.getProperty(<span style=color:#5af78e>&#34;storeFile&#34;</span>) <span style=color:#ff6ac1>?:</span> <span style=color:#5af78e>&#34;NOT_FOUND&#34;</span>)
</span></span><span style=display:flex><span>        storePassword = local.getProperty(<span style=color:#5af78e>&#34;storePassword&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here&rsquo;s the complete step, with the keystore decrypting and the properties file creation:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Configure Keystore
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#39;${{ secrets.KEYSTORE_FILE }}&#39;&gt; release.keystore.asc
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    gpg -d --passphrase &#39;${{ secrets.KEYSTORE_PASSPHRASE }}&#39; --batch release.keystore.asc &gt; androidApp/release.keystore
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;storeFile=release.keystore&#34; &gt;&gt; keystore.properties
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;keyAlias=$KEYSTORE_KEY_ALIAS&#34; &gt;&gt; keystore.properties
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;storePassword=$KEYSTORE_STORE_PASSWORD&#34; &gt;&gt; keystore.properties
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;keyPassword=$KEYSTORE_KEY_PASSWORD&#34; &gt;&gt; keystore.properties</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>KEYSTORE_KEY_ALIAS</span>: ${{ secrets.KEYSTORE_KEY_ALIAS }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>KEYSTORE_KEY_PASSWORD</span>: ${{ secrets.KEYSTORE_KEY_PASSWORD }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>KEYSTORE_STORE_PASSWORD</span>: ${{ secrets.KEYSTORE_STORE_PASSWORD }}
</span></span></code></pre></div><h2 id=optional-firebase-configuration-or-other-secrets>[Optional] Firebase configuration or other secrets</h2><p>GitHub secrets can be leveraged to store any sensitive stuff or configuration that can&rsquo;t be exposed to version control.</p><p>To do so, any file can be encoded with <code>base64</code> and saved inside a GitHub secret.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>base64 -i myfile.extension
</span></span></code></pre></div><p>Then, the GitHub action can decode the content and create the file. For example, here&rsquo;s the step for the Firebase JSON configuration:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create Firebase json
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;$FIREBASE_JSON&#34; &gt; androidApp/google-services.json.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    base64 -d -i androidApp/google-services.json.b64 &gt; androidApp/google-services.json</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>FIREBASE_JSON</span>: ${{ secrets.FIREBASE_JSON }}
</span></span></code></pre></div><h2 id=publish-on-google-play-console>Publish on Google Play Console</h2><p>To publish the APK or AAB to the Play Console, I&rsquo;m using the <a href=https://github.com/Triple-T/gradle-play-publisher>Gradle Play Publisher plugin</a>.</p><p>To communicate and authenticate with the Play Console, the plugin requires a <a href=https://cloud.google.com/iam/docs/service-account-overview>Service Account</a>. The steps needed to create a Service Account for the Play Console are well described <a href=https://github.com/Triple-T/gradle-play-publisher#service-account>in the plugin documentation</a>. All the information required for the authentication will be contained in a JSON file that needs to be provided to the Gradle plugin:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>play {
</span></span><span style=display:flex><span>    serviceAccountCredentials.<span style=color:#ff6ac1>set</span>(<span style=color:#ff6ac1>file</span>(<span style=color:#5af78e>&#34;../play_config.json&#34;</span>))
</span></span><span style=display:flex><span>    track.<span style=color:#ff6ac1>set</span>(<span style=color:#5af78e>&#34;alpha&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the plugin configuration, I also specify that I want to upload the APK on the Alpha track of the Play Console. The plugin is very customizable, and all the possibilities can be found <a href="https://github.com/Triple-T/gradle-play-publisher?tab=readme-ov-file#common-configuration">in the documentation</a>.</p><blockquote><p>N.B. The first version on the Play Console needs to be manually uploaded before using any automation.</p></blockquote><p>To provide the JSON in the GitHub Action, the method described <a href=#optional-firebase-configuration-or-other-secrets>in the previous section</a> can be used: the content of the JSON will be stored in the GitHub secrets encoded in base64.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create Google Play Config file
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;$PLAY_CONFIG_JSON&#34; &gt; play_config.json.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    base64 -d -i play_config.json.b64 &gt; play_config.json</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>PLAY_CONFIG_JSON</span>: ${{ secrets.PLAY_CONFIG }}
</span></span></code></pre></div><p>The <code>publishBundle</code> Gradle command can be used to upload the app on the Play Console:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Distribute app to Alpha track
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: ./gradlew :androidApp:bundleRelease :androidApp:publishBundle
</span></span></code></pre></div><h2 id=conclusions>Conclusions</h2><p>And that&rsquo;s all the steps required to automatically publish a Kotlin Multiplatform Android app on the Play Console with a GitHub Action.</p><p>Here&rsquo;s the entire GitHub Action for reference:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>name</span>: Android Alpha Release
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5af78e>&#39;*-android&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: actions/checkout@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: set up JDK
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/setup-java@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>distribution</span>: <span style=color:#5af78e>&#39;zulu&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>java-version</span>: <span style=color:#ff9f43>18</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: gradle/actions/setup-gradle@v3
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>gradle-home-cache-cleanup</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>cache-encryption-key</span>: ${{ secrets.GRADLE_CACHE_ENCRYPTION_KEY }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Cache KMP tooling
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/cache@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>path</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>            </span>            ~/.konan
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>key</span>: ${{ runner.os }}-v1-${{ hashFiles(&#39;*.versions.toml&#39;) }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Configure Keystore
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#39;${{ secrets.KEYSTORE_FILE }}&#39;&gt; release.keystore.asc
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          gpg -d --passphrase &#39;${{ secrets.KEYSTORE_PASSPHRASE }}&#39; --batch release.keystore.asc &gt; androidApp/release.keystore
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;storeFile=release.keystore&#34; &gt;&gt; keystore.properties
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;keyAlias=$KEYSTORE_KEY_ALIAS&#34; &gt;&gt; keystore.properties
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;storePassword=$KEYSTORE_STORE_PASSWORD&#34; &gt;&gt; keystore.properties
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;keyPassword=$KEYSTORE_KEY_PASSWORD&#34; &gt;&gt; keystore.properties</span>          
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>KEYSTORE_KEY_ALIAS</span>: ${{ secrets.KEYSTORE_KEY_ALIAS }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>KEYSTORE_KEY_PASSWORD</span>: ${{ secrets.KEYSTORE_KEY_PASSWORD }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>KEYSTORE_STORE_PASSWORD</span>: ${{ secrets.KEYSTORE_STORE_PASSWORD }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create Firebase json
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;$FIREBASE_JSON&#34; &gt; androidApp/google-services.json.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          base64 -d -i androidApp/google-services.json.b64 &gt; androidApp/google-services.json</span>          
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>FIREBASE_JSON</span>: ${{ secrets.FIREBASE_JSON }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create Google Play Config file
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;$PLAY_CONFIG_JSON&#34; &gt; play_config.json.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          base64 -d -i play_config.json.b64 &gt; play_config.json</span>          
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>PLAY_CONFIG_JSON</span>: ${{ secrets.PLAY_CONFIG }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Distribute app to Alpha track
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: ./gradlew :androidApp:bundleRelease :androidApp:publishBundle
</span></span></code></pre></div><p>You can check the action <a href=https://github.com/prof18/feed-flow/blob/main/.github/workflows/android-alpha-release.yaml>on GitHub</a></p></section><div class=article-footer><div class=body>To stay up to date with my writing and my projects, follow me on <a href=https://androiddev.social/@marcogom target=_blank>Mastodon</a> or <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-69FZ1TLE7E","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>