<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to publish a Kotlin Multiplatform macOS app on the App Store with GitHub Actions - Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions It&rsquo;s been almost a year since I started working on FeedFlow, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><meta property="og:image" content><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><meta property="og:title" content="How to publish a Kotlin Multiplatform macOS app on the App Store with GitHub Actions"><meta property="og:description" content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions It&rsquo;s been almost a year since I started working on FeedFlow, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2024/kmp-ci-macos-appstore/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-20T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-20T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to publish a Kotlin Multiplatform macOS app on the App Store with GitHub Actions"><meta name=twitter:description content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions It&rsquo;s been almost a year since I started working on FeedFlow, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><script async src="https://www.googletagmanager.com/gtag/js?id=G-69FZ1TLE7E"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-69FZ1TLE7E",{anonymize_ip:!1})}</script><script src=https://www.marcogomiero.com/js/feather.min.js></script>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.marcogomiero.com/css/main.f2c7f60ec2d0155a784ade9b1b272143e1b8eb864a95bf75e606b49d8774389e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://www.marcogomiero.com/css/dark.26c5bf79ef760a8f4feb8fc7be32ec86fc1f1da292b42c9fcc37879d4f774e3f.css disabled></head><body><div class=content><header><div class=main><a href=https://www.marcogomiero.com><h2>Marco Gomiero</h2></a></div><nav class=navbar><a href=/posts/><span>Write</span></a>
<a href=/talks/><span>Speak</span></a>
<a href=/projects/><span>Build</span></a>
<a href=/about-me/><span>About</span></a>
| <span class=dark-mode-toggle id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.marcogomiero.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>How to publish a Kotlin Multiplatform macOS app on the App Store with GitHub Actions</h1><div class=post-meta><span title='2024-05-20 00:00:00 +0000 UTC'>20 May 2024</span></div></div><section class=body><blockquote><p><strong>SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.</strong></p><ul><li>Part 1: <a href=https://www.marcogomiero.com/posts/2024/kmp-ci-android>How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions</a></li><li>Part 2: <a href=https://www.marcogomiero.com/posts/2024/kmp-ci-ios>How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions</a></li><li>Part 3: <a href=https://www.marcogomiero.com/posts/2024/kmp-ci-macos-github-releases>How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions</a></li><li>Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions</li></ul></blockquote><p>It&rsquo;s been almost a year since I started working on <a href=https://www.feedflow.dev/>FeedFlow</a>, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app.</p><p>To be faster and &ldquo;machine-agnostic&rdquo; with the deployments, I decided to have a CI (Continuous Integration) on GitHub Actions to quickly deploy my application to all the stores (Play Store, App Store for iOS and macOS, and on GitHub release for the macOS app).</p><p>In this post, I will show how to deploy a Kotlin Multiplatform macOS app on the macOS App Store. This post is part of a series dedicated to setting up a CI for deploying a Kotlin Multiplatform app on Google Play, Apple App Store for iOS and macOS, and GitHub releases for distributing a macOS app outside the App Store. To keep up to date, you can check out the other instances of the series in the index above or follow me on <a href=https://androiddev.social/@marcogom>Mastodon</a> or <a href=https://twitter.com/marcoGomier>Twitter</a>.</p><p>This post won&rsquo;t cover the Gradle configuration required to create native distributions or any additional customizations necessary to deploy the app on the App Store.</p><p>More info is available on Compose Multiplatform documentation:</p><blockquote><p><a href=https://github.com/JetBrains/compose-multiplatform/blob/master/tutorials/Native_distributions_and_local_execution/README.md>Native distributions & local execution</a></p></blockquote><blockquote><p><a href=https://github.com/JetBrains/compose-multiplatform/blob/master/tutorials/Signing_and_notarization_on_macOS/README.md#configuring-gradle>Signing and notarizing distributions for macOS - Configuring Gradle</a></p></blockquote><p>and in another article where I cover all the necessary things required to publish a macOS Compose app on the macOS App Store:</p><blockquote><p><a href=https://www.marcogomiero.com/posts/2024/compose-macos-app-store>Publishing a Compose macOS app on App Store: architectures, sandboxing and native libraries</a></p></blockquote><p>For reference, you can also check <a href=https://github.com/prof18/feed-flow/blob/main/desktopApp/build.gradle.kts>FeedFlow&rsquo;s Gradle configuration</a>.</p><h2 id=triggers>Triggers</h2><p>A trigger is necessary to trigger the GitHub Action. I&rsquo;ve decided to trigger a new release when I add a tag that ends with the platform name, in this case, <code>-desktop</code>. So, for example, a tag would be <code>0.0.1-desktop</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5af78e>&#39;*-desktop&#39;</span>
</span></span></code></pre></div><p>In this way, I can be more flexible when making platform-independent releases.</p><h2 id=gradle-and-jdk-setup>Gradle and JDK setup</h2><p>The first part of the pipeline involves cloning the repo and setting up the infrastructure: JDK and Gradle.</p><h3 id=clone-the-repository>Clone the repository</h3><p>The <code>actions/checkout</code> action can be used to clone the repository:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: actions/checkout@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span></code></pre></div><h3 id=jdk-setup>JDK Setup</h3><p>The <code>actions/setup-java</code> action can be used to set up a desired JDK. I want the <code>zulu</code> distribution and version 18 in this case.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: set up JDK
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: actions/setup-java@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>distribution</span>: <span style=color:#5af78e>&#39;zulu&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>java-version</span>: <span style=color:#ff9f43>18</span>
</span></span></code></pre></div><h3 id=gradle-setup>Gradle Setup</h3><p>The <code>gradle/actions/setup-gradle</code> action can be used to set up Gradle with its cache.</p><p>In the action, I&rsquo;m using two parameters: <code>gradle-home-cache-cleanup</code> and <code>cache-encryption-key</code>.</p><p>The <code>gradle-home-cache-cleanup</code> parameter will enable a feature that will try to delete any files in the Gradle User Home that were not used by Gradle during the GitHub Actions Workflow before saving the cache. In this way, some space can be saved. More info can be found <a href=https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#remove-unused-files-from-gradle-user-home-before-saving-to-the-cache>in the documentation</a>.</p><p>Instead, the <code>cache-encryption-key</code> parameter provides an encryption key from the GitHub secrets to encrypt the configuration cache. The configuration cache might contain stored credentials and other secrets, so encrypting it before saving it on the GitHub cache is better. More info can be found <a href=https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#saving-configuration-cache-data>in the documentation</a>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: gradle/actions/setup-gradle@v3
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>gradle-home-cache-cleanup</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>cache-encryption-key</span>: ${{ secrets.GRADLE_CACHE_ENCRYPTION_KEY }}
</span></span></code></pre></div><h3 id=kotlin-native-setup>Kotlin Native setup</h3><p>When compiling a Kotlin Multiplatform project that also targets Kotlin Native, some required components will be downloaded in the <code>$USER_HOME/.konan</code> directory. Kotlin Native will also create and use some cache in this directory.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>├── .konan
</span></span><span style=display:flex><span>│   ├── cache
</span></span><span style=display:flex><span>│   ├── dependencies
</span></span><span style=display:flex><span>│   └── kotlin-native-prebuilt-macos-aarch64-1.9.23
</span></span></code></pre></div><p>Caching that directory will avoid redownloading and unnecessary computation. The <code>actions/cache</code> action can be used to do so.</p><p>The action requires a key to identify the cache uniquely; in this case, the key will be a hash of the version catalog file since the Kotlin version number is stored there:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Cache KMP tooling
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: actions/cache@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>path</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>      </span>      ~/.konan
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>key</span>: ${{ runner.os }}-v1-${{ hashFiles(&#39;*.versions.toml&#39;) }}
</span></span></code></pre></div><h2 id=setup-signing-certificates>Setup signing certificates</h2><p>Every macOS application must be signed to be distributed in the app store. The certificates required to sign a macOS application for distribution are <code>Mac App Distribution</code> and <code>Mac Installer Distribution</code>. Those certificates can be generated and downloaded from <a href=https://developer.apple.com/account/resources/certificates/add>the Apple Developer website</a> by uploading a Certificate Signing Request.</p><p>This request can be obtained from the Keychain app on macOS by opening the menu <code>Keychain Access > Certificate Assistant > Request a Certificate From a Certificate Authority</code>. An email must be added to the form that will appear, and the <code>Save to disk</code> option must be selected. The CA Email address field can be blank because the request will be saved on the disk. More information can be found <a href=https://support.apple.com/en-am/guide/keychain-access/kyca2793/mac>in the Apple documentation</a>.</p><p>The certificates can be imported into GitHub Action by using the <code>p12</code> format, an archive file format for storing many cryptography objects as a single file (<a href=https://en.wikipedia.org/wiki/PKCS_12>Wikipedia</a>).</p><p>The Keychain app can be used to generate the <code>p12</code> file. After downloading the certificates, they must be imported into the Keychain app. Once imported, the certificates can be easily exported by selecting them in the Keychain, right-clicking, and selecting the <code>Export 2 items…</code> option. A password will be used to encrypt the <code>p12</code> file.</p><p>The <code>import-codesign-certs</code> action can be used to import the certificate in the <code>p12</code> format. To do so, the <code>p12</code> file must be encoded in <code>base64</code> (with the command <code>base64 -i myfile.extension</code>), and the content must be uploaded to GitHub secrets along with the decryption password.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: import certs
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: apple-actions/import-codesign-certs@v2
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>p12-file-base64</span>: ${{ secrets.CERTIFICATES_P12 }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>p12-password</span>: ${{ secrets.CERTIFICATES_PASSWORD }}
</span></span></code></pre></div><h2 id=provision-profile>Provision Profile</h2><p>A provisioning profile is required to distribute a macOS app in addition to signing the app. The provisioning profile ensures that a trusted developer in the Apple Developer Program created and signed the app. This measure prevents unauthorized apps from being used because macOS validates the provisioning profile to ensure that it has been signed with a legitimate certificate from the developer&rsquo;s account.</p><p>Two provisioning profiles called <code>Mac App Store Connect</code> are required: one for the app and one for the JVM runtime that is included in the app binary. Those profiles can be created and downloaded on the <a href=https://developer.apple.com/account/resources/profiles/add>Apple Developer Website</a>.</p><p>The <code>App ID</code> is required to create a provisioning profile. It can be created on the <a href=https://developer.apple.com/account/resources/identifiers/add/bundleId>Apple Developer Website</a>. An additional <code>App ID</code> is necessary for the provisioning profile of the JVM runtime: this ID is composed of the <code>App ID</code> of the app, prepended by <code>com.oracle.java</code>. For example, if the <code>App ID</code> of the app is <code>com.yoursitename.yourappname</code>, the <code>App ID</code> of the runtime will be <code>com.oracle.java.com.yoursitename.yourappname</code></p><p>The provisioning profiles are loaded in the project through Gradle properties set inside the desktop project&rsquo;s <code>build.gradle.kts</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>macOS {
</span></span><span style=display:flex><span>    provisioningProfile.set(project.file(&#34;embedded.provisionprofile&#34;))
</span></span><span style=display:flex><span>    runtimeProvisioningProfile.set(project.file(&#34;runtime.provisionprofile&#34;))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The provisioning profiles can&rsquo;t be publicly released for security reasons, so a good approach is to encode them to <code>base64</code> (with the command <code>base64 -i myfile.extension</code>) and save them inside GitHub secrets.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create Embedded Provision Profile
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;$EMBEDDED_PROVISION&#34; &gt; desktopApp/embedded.provisionprofile.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    base64 -d -i desktopApp/embedded.provisionprofile.b64 &gt; desktopApp/embedded.provisionprofile</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>EMBEDDED_PROVISION</span>: ${{ secrets.EMBEDDED_PROVISION }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create Runtime Provision Profile
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;$RUNTIME_PROVISION&#34; &gt; desktopApp/runtime.provisionprofile.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    base64 -d -i desktopApp/runtime.provisionprofile.b64 &gt; desktopApp/runtime.provisionprofile</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>RUNTIME_PROVISION</span>: ${{ secrets.RUNTIME_PROVISION }}
</span></span></code></pre></div><h2 id=prepare-variables-for-version-and-binary-path>Prepare variables for version and binary path</h2><p>During the action, some information like the git tag, version name, and binary path are needed. That&rsquo;s why I&rsquo;ve dedicated a step to compute and save them inside GitHub environmental variables.</p><p>The tag I use for releases comprises the version name and the platform type, such as <code>1.0.0-desktop</code>. Thus, the version name can be easily extracted from the tag that triggered the build.</p><p>The path of the application binary instead, it&rsquo;s <code>desktopApp/build/release/main-release/dmg/${name}</code>, where the name is the <code>packageName</code> of the app set on the <code>build.gradle.kts</code> file, followed by the version, in this case, <code>FeedFlow-1.0.0.dmg</code></p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create path variables
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>id</span>: path_variables
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    tag=$(git describe --tags --abbrev=0 --match &#34;*-desktop&#34;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    version=$(echo &#34;$tag&#34; | sed &#39;s/-desktop$//&#39;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    name=&#34;FeedFlow-${version}.dmg&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    path=&#34;desktopApp/build/release/main-release/dmg/${name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;TAG=$tag&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;VERSION=$version&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;RELEASE_PATH=$path&#34; &gt;&gt; $GITHUB_ENV</span>    
</span></span></code></pre></div><h2 id=build-the-pkg>Build the pkg</h2><p>The format of a macOS app distributed in the App Store is <code>pkg</code>. The <code>packageReleasePkg</code> Gradle task can be used to build a <code>pkg</code>. The task also sets the Gradle property <code>macOsAppStoreRelease</code> to <code>true</code> because the Compose Multiplatform Gradle Plugin needs to know if the app will be distributed on or outside the App Store. This is a custom property that I&rsquo;ve created to handle different configurations when bundling for the App Store.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create PKG
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>run</span>: ./gradlew packageReleasePkg -PmacOsAppStoreRelease=true
</span></span></code></pre></div><h2 id=upload-on-testflight>Upload on TestFlight</h2><p>A macOS app can be uploaded to the App Store through <a href=https://developer.apple.com/testflight/>TestFlight</a>. The upload can be performed with the <code>upload-testflight-build</code> action.</p><p>As for the provisioning profile, this action uses the <a href=https://developer.apple.com/documentation/appstoreconnectapi>App Store Connect API</a> to communicate with TestFlight. For this reason, the action requires the same issuer ID, key ID, and private key used in the provisioning step. Additionally, it requires the path of the IPA archive, which can be provided by GitHub environmental variables and the app type: <code>osx</code>, in this case.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: Apple-Actions/upload-testflight-build@v1
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>app-type</span>: <span style=color:#5af78e>&#39;osx&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>app-path</span>: ${{ env.ipa_path }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>issuer-id</span>: ${{ secrets.APPSTORE_ISSUER_ID }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>api-key-id</span>: ${{ secrets.APPSTORE_KEY_ID }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>api-private-key</span>: ${{ secrets.APPSTORE_PRIVATE_KEY }}
</span></span></code></pre></div><h2 id=conclusions>Conclusions</h2><p>And that&rsquo;s all the steps required to automatically publish a Kotlin Multiplatform macOS app on the App Store with a GitHub Action.</p><p>Here&rsquo;s the entire GitHub Action for reference:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>name</span>: Desktop MacOS Testflight Release
</span></span><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5af78e>&#39;*-desktop&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>runs-on</span>: macos-14
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>timeout-minutes</span>: <span style=color:#ff9f43>40</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: actions/checkout@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: set up JDK
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/setup-java@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>distribution</span>: <span style=color:#5af78e>&#39;zulu&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>java-version</span>: <span style=color:#ff9f43>18</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: gradle/actions/setup-gradle@v3
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>gradle-home-cache-cleanup</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>cache-encryption-key</span>: ${{ secrets.GRADLE_CACHE_ENCRYPTION_KEY }}                  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Cache KMP tooling
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/cache@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>path</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>            </span>            ~/.konan
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>key</span>: ${{ runner.os }}-v1-${{ hashFiles(&#39;*.versions.toml&#39;) }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Import Mac App Distribution and Installer certificate
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: apple-actions/import-codesign-certs@v2
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>p12-file-base64</span>: ${{ secrets.MAC_APP_DISTRIBUTION_INSTALLER_CERTIFICATE }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>p12-password</span>: ${{ secrets.MAC_APP_DISTRIBUTION_INSTALLER_CERTIFICATE_PWD }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create Embedded Provision Profile
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;$EMBEDDED_PROVISION&#34; &gt; desktopApp/embedded.provisionprofile.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          base64 -d -i desktopApp/embedded.provisionprofile.b64 &gt; desktopApp/embedded.provisionprofile</span>          
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>EMBEDDED_PROVISION</span>: ${{ secrets.EMBEDDED_PROVISION }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create Runtime Provision Profile
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;$RUNTIME_PROVISION&#34; &gt; desktopApp/runtime.provisionprofile.b64
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          base64 -d -i desktopApp/runtime.provisionprofile.b64 &gt; desktopApp/runtime.provisionprofile</span>          
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>RUNTIME_PROVISION</span>: ${{ secrets.RUNTIME_PROVISION }} 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create path variables
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>id</span>: path_variables
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          tag=$(git describe --tags --abbrev=0 --match &#34;*-desktop&#34;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          version=$(echo &#34;$tag&#34; | sed &#39;s/-desktop$//&#39;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          name=&#34;FeedFlow-${version}.pkg&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          path=&#34;desktopApp/build/release/main-release/pkg/${name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;TAG=$tag&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;VERSION=$version&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;RELEASE_PATH=$path&#34; &gt;&gt; $GITHUB_ENV</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create PKG
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: ./gradlew packageReleasePkg -PmacOsAppStoreRelease=true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: Apple-Actions/upload-testflight-build@v1
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>app-type</span>: <span style=color:#5af78e>&#39;osx&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>app-path</span>: ${{ steps.path_variables.outputs.RELEASE_PATH }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>issuer-id</span>: ${{ secrets.APPSTORE_ISSUER_ID }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>api-key-id</span>: ${{ secrets.APPSTORE_KEY_ID }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>api-private-key</span>: ${{ secrets.APPSTORE_PRIVATE_KEY }}
</span></span></code></pre></div><p>You can check the action <a href=https://github.com/prof18/feed-flow/blob/main/.github/workflows/desktop-macos-testflight-release.yaml>on GitHub</a></p></section><div class=article-footer><div class=body>To stay up to date with my writing and my projects, follow me on <a href=https://androiddev.social/@marcogom target=_blank>Mastodon</a> or <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-69FZ1TLE7E","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>