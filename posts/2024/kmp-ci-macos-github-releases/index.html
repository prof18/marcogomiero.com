<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions - Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - Coming soon It&rsquo;s been almost a year since I started working on FeedFlow, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><meta property="og:image" content><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><meta property="og:title" content="How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions"><meta property="og:description" content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - Coming soon It&rsquo;s been almost a year since I started working on FeedFlow, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2024/kmp-ci-macos-github-releases/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-14T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions"><meta name=twitter:description content="SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.
Part 1: How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions Part 2: How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - Coming soon It&rsquo;s been almost a year since I started working on FeedFlow, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app."><script async src="https://www.googletagmanager.com/gtag/js?id=G-69FZ1TLE7E"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-69FZ1TLE7E",{anonymize_ip:!1})}</script><script src=https://www.marcogomiero.com/js/feather.min.js></script>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.marcogomiero.com/css/main.f2c7f60ec2d0155a784ade9b1b272143e1b8eb864a95bf75e606b49d8774389e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://www.marcogomiero.com/css/dark.2d1f13dc82ea2d94683809543a326af8a9a1f3a6c000f7b7af5d8f02a2e6ec25.css disabled></head><body><div class=content><header><div class=main><a href=https://www.marcogomiero.com><h2>Marco Gomiero</h2></a></div><nav class=navbar><a href=/posts/><span>Write</span></a>
<a href=/talks/><span>Speak</span></a>
<a href=/projects/><span>Build</span></a>
<a href=/about-me/><span>About</span></a>
| <span class=dark-mode-toggle id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.marcogomiero.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions</h1><div class=post-meta><span title='2024-05-14 00:00:00 +0000 UTC'>14 May 2024</span></div></div><section class=body><blockquote><p><strong>SERIES: Publishing a Kotlin Multiplatform Android, iOS, and macOS app with GitHub Actions.</strong></p><ul><li>Part 1: <a href=https://www.marcogomiero.com/posts/2024/kmp-ci-android>How to publish a Kotlin Multiplatform Android app on Play Store with GitHub Actions</a></li><li>Part 2: <a href=https://www.marcogomiero.com/posts/2024/kmp-ci-ios>How to publish a Kotlin Multiplatform iOS app on App Store with GitHub Actions</a></li><li>Part 3: How to publish a Kotlin Multiplatform macOS app on GitHub Releases with GitHub Actions</li><li>Part 4: How to publish a Kotlin Multiplatform macOS app on App Store with GitHub Actions - <em>Coming soon</em></li></ul></blockquote><p>It&rsquo;s been almost a year since I started working on <a href=https://www.feedflow.dev/>FeedFlow</a>, an RSS Reader available on Android, iOS, and macOS, built with Jetpack Compose for the Android app, Compose Multiplatform for the desktop app, and SwiftUI for the iOS app.</p><p>To be faster and &ldquo;machine-agnostic&rdquo; with the deployments, I decided to have a CI (Continuous Integration) on GitHub Actions to quickly deploy my application to all the stores (Play Store, App Store for iOS and macOS, and on GitHub release for the macOS app).</p><p>In this post, I will show how to deploy a Kotlin Multiplatform macOS app outside the Mac App Store using GitHub Releases. This post is part of a series dedicated to setting up a CI for deploying a Kotlin Multiplatform app on Google Play, Apple App Store for iOS and macOS, and GitHub releases for distributing a macOS app outside the App Store. To keep up to date, you can check out the other instances of the series in the index above or follow me on <a href=https://androiddev.social/@marcogom>Mastodon</a> or <a href=https://twitter.com/marcoGomier>Twitter</a>.</p><p>This post won&rsquo;t cover the Gradle configuration required to create and customize native distributions. More info is available on Compose Multiplatform documentation:</p><blockquote><p><a href=https://github.com/JetBrains/compose-multiplatform/blob/master/tutorials/Native_distributions_and_local_execution/README.md>Native distributions & local execution</a></p></blockquote><blockquote><p><a href=https://github.com/JetBrains/compose-multiplatform/blob/master/tutorials/Signing_and_notarization_on_macOS/README.md#configuring-gradle>Signing and notarizing distributions for macOS - Configuring Gradle</a></p></blockquote><p>For reference, you can also check <a href=https://github.com/prof18/feed-flow/blob/main/desktopApp/build.gradle.kts>FeedFlow&rsquo;s Gradle configuration</a>.</p><h2 id=triggers>Triggers</h2><p>A trigger is necessary to trigger the GitHub Action. I&rsquo;ve decided to trigger a new release on GitHub Releases only when the deployment to the macOS App Store is done.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>workflow_run</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>workflows</span>: [<span style=color:#5af78e>&#34;Desktop MacOS Testflight Release&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>types</span>:
</span></span><span style=display:flex><span>      - completed
</span></span></code></pre></div><p>This way, if something goes wrong with the App Store release and I need to redo it with the same version tag, this job won&rsquo;t be triggered again.</p><p>Alternatively, a new release can be triggered when a tag that ends with the platform name is added, in this case, <code>-desktop</code>. So, for example, a tag would be <code>0.0.1-desktop</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5af78e>&#39;*-desktop&#39;</span>
</span></span></code></pre></div><h2 id=gradle-and-jdk-setup>Gradle and JDK setup</h2><p>The first part of the pipeline involves cloning the repo and setting up the infrastructure: JDK and Gradle.</p><h3 id=clone-the-repository>Clone the repository</h3><p>The <code>actions/checkout</code> action can be used to clone the repository:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: actions/checkout@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span></code></pre></div><h3 id=jdk-setup>JDK Setup</h3><p>The <code>actions/setup-java</code> action can be used to set up a desired JDK. In this case, I want the <code>zulu</code> distribution and version 18.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: set up JDK
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: actions/setup-java@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>distribution</span>: <span style=color:#5af78e>&#39;zulu&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>java-version</span>: <span style=color:#ff9f43>18</span>
</span></span></code></pre></div><h3 id=gradle-setup>Gradle Setup</h3><p>The <code>gradle/actions/setup-gradle</code> action can be used to set up Gradle with its cache.</p><p>In the action, I&rsquo;m using two parameters: <code>gradle-home-cache-cleanup</code> and <code>cache-encryption-key</code>.</p><p>The <code>gradle-home-cache-cleanup</code> parameter will enable a feature that will try to delete any files in the Gradle User Home that were not used by Gradle during the GitHub Actions Workflow before saving the cache. In this way, some space can be saved. More info can be found <a href=https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#remove-unused-files-from-gradle-user-home-before-saving-to-the-cache>in the documentation</a>.</p><p>The <code>cache-encryption-key</code> parameter provides an encryption key from the GitHub secrets to encrypt the configuration cache. The configuration cache might contain stored credentials and other secrets, so encrypting it before saving it on the GitHub cache is better. More info can be found <a href=https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#saving-configuration-cache-data>in the documentation</a>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>uses</span>: gradle/actions/setup-gradle@v3
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>gradle-home-cache-cleanup</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>cache-encryption-key</span>: ${{ secrets.GRADLE_CACHE_ENCRYPTION_KEY }}
</span></span></code></pre></div><h3 id=kotlin-native-setup>Kotlin Native setup</h3><p>When compiling a Kotlin Multiplatform project that also targets Kotlin Native, some required components will be downloaded in the <code>$USER_HOME/.konan</code> directory. Kotlin Native will also create and use some cache in this directory.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>├── .konan
</span></span><span style=display:flex><span>│   ├── cache
</span></span><span style=display:flex><span>│   ├── dependencies
</span></span><span style=display:flex><span>│   └── kotlin-native-prebuilt-macos-aarch64-1.9.23
</span></span></code></pre></div><p>Caching that directory will avoid redownloading and unnecessary computation. The <code>actions/cache</code> action can be used to do so.</p><p>The action requires a key to identify the cache uniquely; in this case, the key will be a hash of the version catalog file since the Kotlin version number is stored there:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Cache KMP tooling
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: actions/cache@v4
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>path</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>      </span>      ~/.konan
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>key</span>: ${{ runner.os }}-v1-${{ hashFiles(&#39;*.versions.toml&#39;) }}
</span></span></code></pre></div><h2 id=signing-certificates>Signing Certificates</h2><p>Every macOS application must be signed to be distributed, even outside the App Store. The certificate required to sign a macOS application for distribution outside the app store is called <code>Developer ID Application</code>. This certificate can be generated and downloaded from <a href=https://developer.apple.com/account/resources/certificates/add>the Apple Developer website</a> by uploading a Certificate Signing Request.</p><p>This request can be obtained from the Keychain app on macOS by opening the menu <code>Keychain Access > Certificate Assistant > Request a Certificate From a Certificate Authority</code>. An email must be added in the form that will appear, and the <code>Save to disk</code> option must be selected. The CA Email address field can be blank instead because the request will be saved on the disk. More information can be found <a href=https://support.apple.com/en-am/guide/keychain-access/kyca2793/mac>in the Apple documentation</a>.</p><p>The certificate can be imported into GitHub Action by using the <code>p12</code> format, an archive file format for storing many cryptography objects as a single file (<a href=https://en.wikipedia.org/wiki/PKCS_12>Wikipedia</a>).</p><p>The Keychain app can generate the <code>p12</code> file. After downloading the certificate, it must be imported into the Keychain app. Once imported, the certificate can be easily exported by selecting it in the Keychain, right-clicking, and selecting the <code>Export "&lt;certificate-name>"</code> option. A password will be used to encrypt the <code>p12</code> file.</p><p>The <code>import-codesign-certs</code> action can be used to import the certificate in the <code>p12</code> format. To do so, the <code>p12</code> file must be encoded in <code>base64</code> (with the command <code>base64 -i myfile.extension</code>), and the content must be uploaded into GitHub secrets along with the decryption password.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: import certs
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: apple-actions/import-codesign-certs@v2
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>p12-file-base64</span>: ${{ secrets.CERTIFICATES_P12 }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>p12-password</span>: ${{ secrets.CERTIFICATES_PASSWORD }}
</span></span></code></pre></div><h2 id=prepare-variables-for-version-and-binary-path>Prepare variables for version and binary path</h2><p>During the action, some information like the git tag, version name, and the path of the binary is needed. That&rsquo;s why I&rsquo;ve dedicated a step to computing and saving them inside GitHub environmental variables.</p><p>The tag I use for releases consists of the version name and the platform type, such as <code>1.0.0-desktop</code>. Thus, the tag that triggered the build can easily extract the version name.</p><p>The path of the application binary instead, it&rsquo;s <code>desktopApp/build/release/main-release/dmg/${name}</code>, where the name is the <code>packageName</code> of the app set on the <code>build.gradle.kts</code> file, followed by the version, in this case, <code>FeedFlow-1.0.0.dmg</code>. This path is not the default one, and it can be customized in the <code>build.gradle.kts</code> file.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>compose {
</span></span><span style=display:flex><span>    desktop {
</span></span><span style=display:flex><span>        application {
</span></span><span style=display:flex><span>            nativeDistributions {
</span></span><span style=display:flex><span>                outputBaseDir.<span style=color:#ff6ac1>set</span>(layout.buildDirectory.asFile.<span style=color:#ff6ac1>get</span>().resolve(<span style=color:#5af78e>&#34;release&#34;</span>))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here&rsquo;s the complete step:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create path variables
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>id</span>: path_variables
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    tag=$(git describe --tags --abbrev=0 --match &#34;*-desktop&#34;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    version=$(echo &#34;$tag&#34; | sed &#39;s/-desktop$//&#39;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    name=&#34;FeedFlow-${version}.dmg&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    path=&#34;desktopApp/build/release/main-release/dmg/${name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;TAG=$tag&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;VERSION=$version&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    echo &#34;RELEASE_PATH=$path&#34; &gt;&gt; $GITHUB_ENV</span>    
</span></span></code></pre></div><h2 id=build-the-app>Build the app:</h2><p>The format of a macOS app distributed outside the App Store is <code>dmg</code>. The <code>packageReleaseDmg</code> Gradle task can be used to build a <code>dmg</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Create DMG
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: ./gradlew packageReleaseDmg
</span></span></code></pre></div><h2 id=notarization>Notarization</h2><p><a href=https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution>Notarization</a> is a mandatory step for distributing a macOS application outside the App Store.</p><p>In this process, Apple automatically scans the app&rsquo;s content to ensure it does not contain malware or malicious content. It also checks for any code-signing issues to ensure a registered developer has signed the app.</p><p>Notarization can be done with the <code>notarytool</code> command-line tool:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xcrun notarytool submit <span style=color:#ff5c57>$RELEASE_PATH</span> --apple-id <span style=color:#ff5c57>$APPLE_ID_NOTARIZATION</span> --password <span style=color:#ff5c57>$NOTARIZATION_PWD</span> --team-id <span style=color:#ff5c57>$APPSTORE_TEAM_ID</span> --wait
</span></span></code></pre></div><p>The command requires some arguments that can be hardcoded directly or provided through GitHub secrets, depending on the level of sensitivity:</p><ul><li><code>$RELEASE_PATH</code>: the path of the <code>dmg</code>;</li><li><code>apple-id</code>: the Apple ID, i.e., the email associated with the developer account</li><li><code>password</code>: an <a href=https://support.apple.com/en-us/102654>app-specific password</a> to log in with the Apple ID; it can be created in the <a href=https://appleid.apple.com/account/manage/section/security>Apple ID account page</a>;</li><li><code>team-id</code>: team ID;</li><li><code>wait</code>: this argument will make the command wait until the notarization process is done.</li></ul><p>The notarization process will usually take between one and three minutes. With the <code>--wait</code> arguments passed to the command-line tool, the execution will be paused until a successful response from Apple.</p><p>After a successful notarization step, the notary service generates a &ldquo;ticket&rdquo; that can be stapled to the app. The &ldquo;ticket&rdquo; is also published online, and when the user first installs or runs the app, Gatekeeper (<a href=https://support.apple.com/en-am/guide/security/sec5599b66df/web>a macOS security feature</a> that restricts app installation by default) will know that the application is secure and legitimate.</p><p>The &ldquo;stapling&rdquo; of the &ldquo;ticket&rdquo; can be done with the <code>stapler</code> command-line tool. The only argument required is the path of the application <code>dmg</code>.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xcrun stapler staple <span style=color:#ff5c57>$RELEASE_PATH</span>
</span></span></code></pre></div><p>Here&rsquo;s the complete step that performs Notarization:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Notarization
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    xcrun notarytool submit $RELEASE_PATH --apple-id $APPLE_ID_NOTARIZATION --password $NOTARIZATION_PWD --team-id $APPSTORE_TEAM_ID --wait
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    xcrun stapler staple $RELEASE_PATH</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>APPLE_ID_NOTARIZATION</span>: ${{ secrets.APPLE_ID_NOTARIZATION }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>APPSTORE_TEAM_ID</span>: ${{ secrets.APPSTORE_TEAM_ID }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>NOTARIZATION_PWD</span>: ${{ secrets.NOTARIZATION_PWD }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>RELEASE_PATH</span>: ${{ env.RELEASE_PATH }}
</span></span></code></pre></div><p>Notarization and stapling can also be done with a Gradle task (<code>notarizeDmg</code>) provided by the Compose Multiplatform Gradle plugin. More info is available <a href=https://github.com/JetBrains/compose-multiplatform/blob/master/tutorials/Signing_and_notarization_on_macOS/README.md#notarization>in the official documentation</a>.</p><h2 id=distribute-the-app-with-github-releases>Distribute the app with Github Releases</h2><p>After the notarization process, the app can be distributed to users. The <code>svenstaro/upload-release-action</code> can be used to upload the app to GitHub Releases.</p><p>The action requires some parameters, such as the git tag, the app binary path, and an optional body for the release notes. In my case, I publish the release as a draft so I can manually add some final touches to the release notes before the publication.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: Upload binaries to release
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>uses</span>: svenstaro/upload-release-action@v2
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>repo_token</span>: ${{ secrets.GITHUB_TOKEN }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>file</span>: ${{ env.RELEASE_PATH }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>tag</span>: ${{ env.TAG }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>overwrite</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>draft</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>body</span>: <span style=color:#5af78e>&#34;Release ${{ env.VERSION }}&#34;</span>
</span></span></code></pre></div><p>The latest release on GitHub can be opened with a link in the following format: <a href=https://github.com/USERNAME/REPO-NAME/releases/latest/>https://github.com/USERNAME/REPO-NAME/releases/latest/</a> (e.g. <a href=https://github.com/prof18/feed-flow/releases>https://github.com/prof18/feed-flow/releases</a>);</p><p>The latest release&rsquo;s binary can instead be downloaded from a link in the following format: <a href=https://github.com/USERNAME/REPO-NAME/releases/latest/download/FILENAME.extension>https://github.com/USERNAME/REPO-NAME/releases/latest/download/FILENAME.extension</a> (e.g., <a href=https://github.com/prof18/feed-flow/releases/latest/download/FeedFlow-1.0.56.dmg>https://github.com/prof18/feed-flow/releases/latest/download/FeedFlow-1.0.56.dmg</a>).</p><h2 id=conclusions>Conclusions</h2><p>And that&rsquo;s all the steps required to automatically publish a Kotlin Multiplatform macOS app on GitHub Releases with a GitHub Action.</p><p>Here&rsquo;s the entire GitHub Action for reference:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff6ac1>name</span>: Desktop MacOS Release
</span></span><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>workflow_run</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>workflows</span>: [<span style=color:#5af78e>&#34;Desktop MacOS Testflight Release&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>types</span>:
</span></span><span style=display:flex><span>      - completed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span>: ${{ github.event.workflow_run.conclusion == &#39;success&#39; }}
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>runs-on</span>: macos-14
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>timeout-minutes</span>: <span style=color:#ff9f43>40</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>permissions</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>contents</span>: write
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: actions/checkout@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: set up JDK
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/setup-java@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>distribution</span>: <span style=color:#5af78e>&#39;zulu&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>java-version</span>: <span style=color:#ff9f43>18</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>uses</span>: gradle/actions/setup-gradle@v3
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>gradle-home-cache-cleanup</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>cache-encryption-key</span>: ${{ secrets.GRADLE_CACHE_ENCRYPTION_KEY }}                
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Cache KMP tooling
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/cache@v4
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>path</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>            </span>            ~/.konan
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>key</span>: ${{ runner.os }}-v1-${{ hashFiles(&#39;*.versions.toml&#39;) }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#78787e># Developer ID Application</span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Import signing certificate
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: apple-actions/import-codesign-certs@v2
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>p12-file-base64</span>: ${{ secrets.SIGNING_CERTIFICATE_P12_DATA_MACOS }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>p12-password</span>: ${{ secrets.SIGNING_CERTIFICATE_PASSWORD_MACOS }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create path variables
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>id</span>: path_variables
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          tag=$(git describe --tags --abbrev=0 --match &#34;*-desktop&#34;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          version=$(echo &#34;$tag&#34; | sed &#39;s/-desktop$//&#39;)
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          name=&#34;FeedFlow-${version}.dmg&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          path=&#34;desktopApp/build/release/main-release/dmg/${name}&#34;
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;TAG=$tag&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;VERSION=$version&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;RELEASE_PATH=$path&#34; &gt;&gt; $GITHUB_ENV</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Create DMG
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: ./gradlew packageReleaseDmg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Notarization
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          xcrun notarytool submit $RELEASE_PATH --apple-id $APPLE_ID_NOTARIZATION --password $NOTARIZATION_PWD --team-id $APPSTORE_TEAM_ID --wait
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          xcrun stapler staple $RELEASE_PATH</span>          
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>APPLE_ID_NOTARIZATION</span>: ${{ secrets.APPLE_ID_NOTARIZATION }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>APPSTORE_TEAM_ID</span>: ${{ secrets.APPSTORE_TEAM_ID }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>NOTARIZATION_PWD</span>: ${{ secrets.NOTARIZATION_PWD }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>RELEASE_PATH</span>: ${{ env.RELEASE_PATH }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Upload binaries to release
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: svenstaro/upload-release-action@v2
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>repo_token</span>: ${{ secrets.GITHUB_TOKEN }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>file</span>: ${{ env.RELEASE_PATH }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>tag</span>: ${{ env.TAG }}
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>overwrite</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>draft</span>: <span style=color:#ff6ac1>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>body</span>: <span style=color:#5af78e>&#34;Release ${{ env.VERSION }}&#34;</span>
</span></span></code></pre></div><p>You can check the action <a href=https://github.com/prof18/feed-flow/blob/main/.github/workflows/desktop-macos-release.yaml>on GitHub</a></p></section><div class=article-footer><div class=body>To stay up to date with my writing and my projects, follow me on <a href=https://androiddev.social/@marcogom target=_blank>Mastodon</a> or <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-69FZ1TLE7E","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>