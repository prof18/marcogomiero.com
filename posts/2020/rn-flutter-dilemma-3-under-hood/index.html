<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Flutter or React Native, a cross-platform dilemma - How they work - (Part 3) | Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="Software Engineer Â· Community Manager"><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><link rel=prev href=https://www.marcogomiero.com/posts/2020/rn-flutter-dilemma-2-ui/><link rel=next href=https://www.marcogomiero.com/posts/2020/rn-flutter-dilemma-4-how-choose/><link rel=canonical href=https://www.marcogomiero.com/posts/2020/rn-flutter-dilemma-3-under-hood/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.marcogomiero.com/img/flutter-rn/virtual-dom.png"><meta name=twitter:title content="Flutter or React Native, a cross-platform dilemma - How they work - (Part 3)"><meta name=twitter:description content="Welcome to the third part of this article series about React Native and Flutter. In the latest episode, we have talked about User Interfaces and how to build them in the two frameworks. In this article, we&rsquo;ll go deeper under the hoods to understand how things work. But I will not go deeper with lot&rsquo;s of details and implementation things, because I want to make you understand how the thing works at a high level."><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Flutter or React Native, a cross-platform dilemma - How they work - (Part 3)","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.marcogomiero.com\/posts\/2020\/rn-flutter-dilemma-3-under-hood\/"},"genre":"posts","wordcount":1487,"url":"https:\/\/www.marcogomiero.com\/posts\/2020\/rn-flutter-dilemma-3-under-hood\/","datePublished":"2020-03-16T00:00:00\u002b00:00","dateModified":"2020-03-16T00:00:00\u002b00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","description":""}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css integrity="sha256-fdcFNFiBMrNfWL6OcAGQz6jDgNTRxnrLEd4vJYFWScE=" crossorigin=anonymous><link rel=stylesheet href=/css/lib/animate/animate.min.min.css><script async defer src=https://buttons.github.io/buttons.js></script></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class=navbar-header><a href=https://www.marcogomiero.com>Marco Gomiero</a></div><div class=navbar-menu><a class=menu-item href=https://www.marcogomiero.com/posts>Posts</a>
<a class=menu-item href=https://www.marcogomiero.com/talks>Talks</a>
<a class=menu-item href=https://www.marcogomiero.com/projects/>Projects</a>
<a class=menu-item href=https://www.marcogomiero.com/about-me/>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div class=navbar-header-title><a href=https://www.marcogomiero.com>Marco Gomiero</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://www.marcogomiero.com/posts>Posts</a>
<a class=menu-item href=https://www.marcogomiero.com/talks>Talks</a>
<a class=menu-item href=https://www.marcogomiero.com/projects/>Projects</a>
<a class=menu-item href=https://www.marcogomiero.com/about-me/>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel=stylesheet><main class=main><div class=container><article class=post-warp><h1 class=post-title>Flutter or React Native, a cross-platform dilemma - How they work - (Part 3)</h1><div class=post-meta><div class=post-meta-main><br></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime="16 Mar 2020">16 Mar 2020</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 1487 words&nbsp;
<i class="far fa-clock fa-fw"></i>7 min&nbsp;</div></div><br><div class=post-content><p>Welcome to the third part of this article series about React Native and Flutter. In the latest episode, we have talked about User Interfaces and how to build them in the two frameworks. In this article, we&rsquo;ll go deeper under the hoods to understand how things work. But I will not go deeper with lot&rsquo;s of details and implementation things, because I want to make you understand how the thing works at a high level. If you are interested to go deeper, I will leave across the article some links for further information.</p><p>But, before moving on, I suggest you read the previous articles of the series if you have lost them.</p><blockquote><p><a href=http://marcogomiero.com/posts/2019/rn-flutter-dilemma-1-intro/>Flutter or React Native, a cross-platform dilemma - Introduction - (Part 1)</a></p></blockquote><blockquote><p><a href=http://marcogomiero.com/posts/2019/rn-flutter-dilemma-2-ui/>Flutter or React Native, a cross-platform dilemma - How to build User Interfaces - (Part 2)</a></p></blockquote><a class=post-dummy-target id=react-native></a><h2>React Native</h2><p>Let&rsquo;s start by analyzing the internals of Rect Native. React Native has an internal infrastructure that is called &ldquo;the <strong>Bridge</strong>&rdquo; and that is built at runtime. The main purpose of the bridge is to create a connection between the native part of the application and the Javascript one, so it can be possible to call native code from the javascript part of the application and vice-versa. The communication between the two different parts is event-driven and in the following gif, you can see an example of that kind of communication.</p><figure><img src=/img/flutter-rn/js-bridge.gif alt=image><figcaption><p>An example of communication between Native and Javascript</p></figcaption></figure><p>Let&rsquo;s analyze what happens here. Let&rsquo;s suppose that we have opened our application. Then, the native code notifies to the bridge that the app has been opened and so the bridge generates a serialized payload that contains that information. This payload is sent to the Javascript code that decides what to do; for example, it decides to render the simple &ldquo;Hello World&rdquo; app that we showed in the latest episode. So again, the information is sent back to the bridge that serializes that information and it sends it back to the native code. At this time, the native code has received all the information that it needs to render the view of the application.
These exchanges of information are performed in an asynchronous way: the messages are collected in a queue that is flushed every 5 ms by default to avoid too much message sending in a short period of time. Nevertheless, this message passing causes some delays especially with a complex layout or long list with complex items.
In fact, the Facebook team is working on a new architecture (codename Fabric) to address this issue and let the UI update synchronously. In just two words, they will get rid of the bridge and the serialization and there will be a Javascript Interface to allow the communication between the Javascript part and the native one. For more information about Fabric I suggest you look to this talk: <a href="https://www.youtube.com/watch?v=UcqRXTriUVI"><em>React Native&rsquo;s New Architecture - Parashuram N - React Conf 2018</em></a></p><a class=post-dummy-target id=flutter></a><h2>Flutter</h2><p>Flutter instead works in a completely different way. In fact, all the widgets are managed and rendered using an engine (written in C++). In the figure below, you can see a representation of the Flutter Engine.</p><figure><img src=/img/flutter-rn/engine.png alt=image><figcaption><p>Flutter Engine</p></figcaption></figure><p>As you can see, there is a block called &ldquo;Skia&rdquo;. <a href=https://skia.org/>Skia</a> is an open-source 2D graphic library managed by Google and you may already know about it, because it is used by Chrome, Chrome OS, Android, Firefox and many others. And in Flutter, Skia is responsible for rendering the widgets in a canvas. In this way, there isn&rsquo;t a continuous communication between the &ldquo;cross-platform technology&rdquo; and the native part and everything is faster. Moreover, all the Dart code is compiled to native code to speed things up. be aware that the compilation to native code is performed only for production build and for this reason debug builds can be slower.</p><a class=post-dummy-target id=comparison></a><h2>Comparison</h2><p>So, in React Native there is a correspondence between the components and the native widgets while Flutter includes its own widgets. This choice has pros and cons. Imagine that Apple and Google update the TextView with some flowers on the shape: an app developed with React Native will ( or better should ) show the flowers without any intervention while an app developed with Flutter won&rsquo;t show it until the Flutter team will add it on their custom TextView. This is a con because we need to wait for another update if there are new things available on the native UI. The pro instead is that there isn&rsquo;t any delay due to the bridge initialization and the runtime translation needed to enable the communication between the javascript part and the native one.</p><a class=post-dummy-target id=common-interesting-features></a><h2>Common interesting features</h2><p>And finally, I want to conclude with some interesting features that both Flutter and React Native have.</p><a class=post-dummy-target id=hot-reload></a><h3>Hot Reload</h3><p>The first one is &ldquo;<strong>Hot Reload</strong>&rdquo;, i.e. the capability of loading new changes without recompiling the entire application again. This feature is really really useful for example when you are trying different colors, font sizes, etc; waiting for an entire recompilation for these little changes it would be such a pain.
In Flutter this feature is possible thanks to a combination of <em>Ahead-of-time</em> (AOT) and <em>Just-in-time</em> compilation. In fact, as mentioned earlier, Flutter generates machine code for production builds. For the debug builds instead, there is a virtual machine that can receive the new code, replace the old one and maintain the state. <a href=https://flutter.dev/docs/resources/technical-overview>Here</a> you can find more information about hot reload in Flutter.</p><p>In React Native instead, the Hot Reload is built on top of <em>Hot Module Replacement</em> by Webpack. Basically there is a runtime included in the app that receives the new code and it replaces the old one. If you are interested in the details, I suggest you read <a href=https://facebook.github.io/react-native/blog/2016/03/24/introducing-hot-reloading.html>this blog post</a> from Facebook.</p><a class=post-dummy-target id=update-only-componentswidgets-that-have-changed></a><h2>Update only components/widgets that have changed</h2><p>Both Flutter and React Native are declarative frameworks. This means that we define the current UI state (e.g. a loading state, an error state, etc.) and the framework manages the state changes. To achieve these, the framework creates an abstract representation of the UI and when the UI state has changed, it builds a new representation that it will be compared and to the previous one and only the differences will be rendered.</p><p>To achieve these, React Native uses a Virtual DOM as UI representation (as you can see in the image below, basically a JSON file that contains all the information about the UI component).</p><figure><img src=/img/flutter-rn/virtual-dom.png alt=image><figcaption><p>Virtual DOM</p></figcaption></figure><p>Then the different DOMs are compared using reconciliation, a heuristic diff comparison algorithm. For more information about it, you can give a look <a href=https://reactjs.org/docs/reconciliation.html>to the React documentation</a>.</p><p>Flutter instead builds an Element Tree as a representation of the UI but instead, it does not use a tree-diffing algorithm to find the differences but instead, for each element of the UI the children list are examined independently.</p><figure><img src=/img/flutter-rn/element-tree.png alt=image><figcaption><p>Flutter Element Tree</p></figcaption></figure><p>For more information about it, you can give a look <a href=https://flutter.dev/docs/resources/inside-flutter>to the Flutter documentation</a>.</p><a class=post-dummy-target id=frankenstein-app></a><h2>âFrankensteinâ App</h2><p>With Flutter and React Native, you can create a view, a screen or even an entire feature and then integrate it in an existing native application. This possibility can be really useful for example for very fast-evolving features or for an MVP feature that we are not so sure that it will be useful or even for a feature that will not be used so much. So it really depends on your situation but I can assure you that is not a crazy thing and maybe in the future, you could find yourself in this situation.</p><p>With React Native, you have to use in your native application a view that will act as a container of the RN app and then you load the javascript bundle that you have previously generated with a kilometric command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>react-native bundle <span class=se>\
</span><span class=se></span>--verbose <span class=se>\
</span><span class=se></span>--platform android <span class=se>\
</span><span class=se></span>--dev <span class=nb>false</span> 
--entry-file index.js <span class=se>\
</span><span class=se></span>--bundle-output your-project/app/src/main/assets/index.android.bundle <span class=se>\ </span>
--assets-dest your-project/app/src/main/res <span class=se>\
</span><span class=se></span>--sourcemap-output utils/android.main.bundle.map
</code></pre></td></tr></table></div></div><p>For more information, please visit the <a href=https://facebook.github.io/react-native/docs/integration-with-existing-apps>official documentation</a>.</p><p>Also in Flutter, you have to define a container view in your native application but instead, you don&rsquo;t need to write a kilometric command to generate bundle: you just add the Flutter project directly from Android Studio and that&rsquo;s it! ( for iOs there is more work to do: you have to add a Flutter SDK hook to the CocoaPods and to Xcode build phase ).</p><p>Again, for more information, I suggest you read the <a href=https://flutter.dev/docs/development/add-to-app>official documentation</a></p><hr><p>And we have reached the end of this journey through the internals of Flutter and React Native. I understand that I went through lots of things in this article but I think that it&rsquo;s necessary to know a little bit about how things work if you choose and work with these frameworks. In fact, the way how these frameworks work can affect your product.</p><p>In the next (final) episode, we&rsquo;ll wrap things up and I&rsquo;ll help you resolve the dilemma!</p></div><section style=width:90%;margin-left:auto;margin-right:auto;margin-top:30px;margin-bottom:30px><hr><div style=padding:25px><div class=post-content>To stay up to date with my writing and my projects, follow me on <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div><hr></section><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href="//twitter.com/share?url=https%3a%2f%2fwww.marcogomiero.com%2fposts%2f2020%2frn-flutter-dilemma-3-under-hood%2f&text=Flutter%20or%20React%20Native%2c%20a%20cross-platform%20dilemma%20-%20How%20they%20work%20-%20%28Part%203%29&via=marcoGomier" target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-fw"></i></a><a href="//reddit.com/submit?url=https%3a%2f%2fwww.marcogomiero.com%2fposts%2f2020%2frn-flutter-dilemma-3-under-hood%2f&title=Flutter%20or%20React%20Native%2c%20a%20cross-platform%20dilemma%20-%20How%20they%20work%20-%20%28Part%203%29" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.marcogomiero.com%2fposts%2f2020%2frn-flutter-dilemma-3-under-hood%2f&title=Flutter%20or%20React%20Native%2c%20a%20cross-platform%20dilemma%20-%20How%20they%20work%20-%20%28Part%203%29" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin fa-fw"></i></a></span></div></div></div><div class=post-info-more><section></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=https://www.marcogomiero.com>Home</a></span></section></div><div class=post-nav><a href=https://www.marcogomiero.com/posts/2020/rn-flutter-dilemma-2-ui/ class=prev rel=prev title="Flutter or React Native, a cross-platform dilemma - How to build User Interfaces - (Part 2)"><i class="fas fa-angle-left fa-fw"></i>Flutter or React Native, a cross-platform dilemma - How to build User Interfaces - (Part 2)</a>
<a href=https://www.marcogomiero.com/posts/2020/rn-flutter-dilemma-4-how-choose/ class=next rel=next title="Flutter or React Native, a cross-platform dilemma - How to chose + Bonus - (Part 4)">Flutter or React Native, a cross-platform dilemma - How to chose + Bonus - (Part 4)<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2017 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.marcogomiero.com>Marco Gomiero</a></span></div><br></div></footer><script src=/js/lib/jquery/jquery.slim.min.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><script src=/js/blog.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-90975904-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span></a></body></html>