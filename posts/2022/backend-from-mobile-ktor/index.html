<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Moving from mobile to backend development with Ktor | Marco Gomiero</title><meta name=keywords content><meta name=description content="SERIES: Building a backend with Ktor
 Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5: Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor   This article is the final instance of the series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that were not easy to achieve out of the box."><meta name=author content="Marco Gomiero"><link rel=canonical href=https://www.marcogomiero.com/posts/2022/backend-from-mobile-ktor/><link crossorigin=anonymous href=/assets/css/stylesheet.min.686715e54e31dbf63447efd76235e41e047fd8826df608657b7b0ddb3a0d900d.css integrity="sha256-aGcV5U4x2/Y0R+/XYjXkHgR/2IJt9ghle3sN2zoNkA0=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://www.marcogomiero.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.marcogomiero.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.marcogomiero.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.marcogomiero.com/apple-touch-icon.png><link rel=mask-icon href=https://www.marcogomiero.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-90975904-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Moving from mobile to backend development with Ktor"><meta property="og:description" content="SERIES: Building a backend with Ktor
 Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5: Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor   This article is the final instance of the series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that were not easy to achieve out of the box."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2022/backend-from-mobile-ktor/"><meta property="og:image" content="https://www.marcogomiero.com/img/ktor-series/commons-layers.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-06T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.marcogomiero.com/img/ktor-series/commons-layers.png"><meta name=twitter:title content="Moving from mobile to backend development with Ktor"><meta name=twitter:description content="SERIES: Building a backend with Ktor
 Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5: Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor   This article is the final instance of the series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that were not easy to achieve out of the box."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.marcogomiero.com/posts/"},{"@type":"ListItem","position":3,"name":"Moving from mobile to backend development with Ktor","item":"https://www.marcogomiero.com/posts/2022/backend-from-mobile-ktor/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Moving from mobile to backend development with Ktor","name":"Moving from mobile to backend development with Ktor","description":"SERIES: Building a backend with Ktor\n Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5: Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor   This article is the final instance of the series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that were not easy to achieve out of the box.","keywords":[],"articleBody":" SERIES: Building a backend with Ktor\n Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5: Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor   This article is the final instance of the series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that were not easy to achieve out of the box. In this article, I will cover why I ended up using Ktor and how was my journey from the mobile to the backend world.\nAfter some experience maintaining an existing backend project developed with Dropwizard, I had to start a new project from scratch. After some research, I chose to go with Ktor, for many reasons.\nFirst of all, Ktor is built with Kotlin and coroutines, two things that I like.\nSecondly, Ktor is lightweight and flexible, because you don’t have to import every feature, but only the things that you need. This is made possible with plugins, i.e. a specific feature (for example Compression, CORS, Cookies, etc) that you decide to install, only if you need it.\nAnd last but not least, Ktor is unopinionated. This allows not to stick to a specific pattern or architecture but to choose the one that better suits the project. And it also allows knowledge transfer, because it will be possible to reuse the existing knowledge acquired in another domain, mobile in my case.\nFor these reasons, I found Ktor easy to use, with a gentle learning curve, even for a mobile developer.\nKnowledge Transfer The main topics that I needed to adapt are 3: architecture, dependency injection and testing.\nArchitecture An Android application is usually divided into 4 different layers:\n Application Presentation Domain Data  The application layer is responsible for starting the application, together with all the different libraries and functionalities that are needed. For example dependency injection, logging, analytics, etc.\nclass MyApp : Application() { override fun onCreate() { super.onCreate() if (BuildConfig.DEBUG) { Timber.plant(Timber.DebugTree()) } initAnalytics() initCrashReporting() initRandomLib() } } The presentation layer is responsible for showing data to the user and interacting with it. In this layer, there are activities/fragments and ViewModels (or the equivalent in other patterns).\nThe domain layer takes care of the specific domain of the application. It is usually composed of UseCases and Repositories where the data are manipulated and prepared before being passed to the presentation layer. This layer usually doesn’t contain any reference to the Android world.\nclass JokeRepositoryImpl( private val jokeLocalDataSource: JokeLocalDataSource ) : JokeRepository { override suspend fun getRandomJoke(): JokeModel { // ...  } } And finally, the data layer, which is the interface to the external world. This layer contains all the code required to retrieve data from the network or a database, for example by using Retrofit or Room.\nOn Ktor the layers are similar.\nThe application layer is responsible for starting the server, together with all the different libraries and functionalities that are needed. Here it is possible to choose Ktor’s plugins that are required in the server.\nfun Application.module(testing: Boolean = false) { install(Koin) { slf4jLogger() modules(koinModules) } install(ContentNegotiation) { json() } install(CallLogging) { level = Level.INFO } install(Locations) routing { ... } } Since a server doesn’t have any UI, the presentation layer is a bit different than in a mobile application. In this case, it is necessary to expose API endpoints to the outside world and not show buttons, checkboxes, etc. I’ve called this layer Resource, but is a completely personal choice (another possible name could be Controller) since Ktor is unopinionated.\n// JokeResource.kt fun Route.jokeEndpoint() { val jokeRepository by inject() get { call.respond(jokeRepository.getRandomJoke()) } post { apiCallParams - val name = apiCallParams.name jokeRepository.watch(name) call.respond(\"Ok\") } } The domain layer will look the same as on Android. Here, there will be UseCases and Repositories where the data are manipulated and prepared before being passed to the presentation layer.\nAnd finally, the concept of data layer will be the same. The only thing that will change is the libraries required to interact with the database or the network. To interact with the database, I chosed Exposed, an ORM developed by Jetbrains.\nWith all the required platform adaptations, the architecture layers are very similar in both the worlds.\n  For this reasons, all the patterns and knowledge used to architect an Android application can be easily adapted and reused to build a backend.\nDependency Injection A topic that doesn’t require any additional knowledge is dependency injection.\nOn Ktor, Koin can be used. And it behaves exactly like on Android: it is necessary to create a module, initialize Koin and then it will possible to retrieve the dependency.\nAndroid:\nval appModule = module { single { HelloRepositoryImpl() } factory { MySimplePresenter(get()) } } class MyApplication : Application() { override fun onCreate() { super.onCreate() startKoin { androidLogger() androidContext(this@MyApplication) modules(appModule) } } } class MainActivity : AppCompatActivity() { val firstPresenter: MySimplePresenter by inject() override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContentView(R.layout.activity_main) ... } } Ktor:\nval appModule = module { single { JokeLocalDataSourceImpl() } single { JokeRepositoryImpl(get()) } } fun Application.module() { install(Koin) { slf4jLogger() modules(koinModules) } ... } fun Route.jokeEndpoint() { val jokeRepository by inject() get { call.respond(jokeRepository.getRandomJoke()) } ... } For more details about DI setup, you can look at the first instance of the series - Structuring a Ktor project.\nTesting Also, testing doesn’t require a completely new set of knowledge. Unit testing will be exactly the same as on Android because it’s platform agnostic.\nIntegration testing instead will be friendlier and easier because no emulator is required. In particular, Ktor does not create a web server but it hooks directly into the internal mechanism with a TestEngine. In this way, the execution of tests will be quicker rather than spinning up a complete web server for testing.\n@Test fun testRequests() = withTestApplication(module(testing = true)) { with(handleRequest(HttpMethod.Get, \"/\")) { assertEquals(HttpStatusCode.OK, response.status()) assertEquals(\"Hello from Ktor Testable sample application\", response.content) } } For more details about testing on Ktor, you can look at the first instance of the series - Structuring a Ktor project.\nConclusions Being unopinionated is the key to knowledge transfer. For this reason, mobile knowledge can be adapted and changed to be ready to develop backend applications with Ktor. However, there will be still some areas that requires more attention and a more deep dive, like scaling and deploying. That was one of the areas where I was lacking knowledge and where I asked for help. But even without the full and complete knowledge, going to the ”other side” and trying new things was really a nice experience that can enrich your vision.\nAnd that’s it for this series. You can check out the other instances of the series in the index above or follow me on Twitter for new content.\nBonus: I’ve spoke about this topic in a talk in the Kotlin Dev Room at Fosdem 2022.\nHere’s the recording of the session:\n ","wordCount":"1193","inLanguage":"en","image":"https://www.marcogomiero.com/img/ktor-series/commons-layers.png","datePublished":"2022-06-06T00:00:00Z","dateModified":"2022-06-06T00:00:00Z","author":{"@type":"Person","name":"Marco Gomiero"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.marcogomiero.com/posts/2022/backend-from-mobile-ktor/"},"publisher":{"@type":"Organization","name":"Marco Gomiero","logo":{"@type":"ImageObject","url":"https://www.marcogomiero.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://www.marcogomiero.com accesskey=h title="Marco Gomiero (Alt + H)">Marco Gomiero</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.marcogomiero.com/posts/ title=Write><span>Write</span></a></li><li><a href=https://www.marcogomiero.com/talks/ title=Speak><span>Speak</span></a></li><li><a href=https://www.marcogomiero.com/projects/ title=Build><span>Build</span></a></li><li><a href=https://www.marcogomiero.com/about-me/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Moving from mobile to backend development with Ktor</h1><div class=post-meta style=margin-top:16px><span title="2022-06-06 00:00:00 +0000 UTC">6 June 2022</span>&nbsp;·&nbsp;6 min</div></header><div class=post-content><blockquote><p><strong>SERIES: Building a backend with Ktor</strong></p><ul><li>Part 1: <a href=https://www.marcogomiero.com/posts/2021/ktor-project-structure/>Structuring a Ktor project</a></li><li>Part 2: <a href=https://www.marcogomiero.com/posts/2021/ktor-logging-on-disk/>How to persist Ktor logs</a></li><li>Part 3: <a href=https://www.marcogomiero.com/posts/2021/ktor-in-memory-db-testing/>How to use an in-memory database for testing on Ktor</a></li><li>Part 4: <a href=https://www.marcogomiero.com/posts/2022/ktor-migration-liquibase/>How to handle database migrations with Liquibase on Ktor</a></li><li>Part 5: <a href=https://www.marcogomiero.com/posts/2022/ktor-setup-documentation/>Generate API documentation from Swagger on Ktor</a></li><li>Part 6: <a href=https://www.marcogomiero.com/posts/2022/ktor-jobs-quartz/>How to schedule jobs with Quartz on Ktor</a></li><li>Part 7: Moving from mobile to backend development with Ktor</li></ul></blockquote><p>This article is the final instance of the series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that were not easy to achieve out of the box. In this article, I will cover why I ended up using Ktor and how was my journey from the mobile to the backend world.</p><p>After some experience maintaining an existing backend project developed with <a href=https://www.dropwizard.io/en/latest/>Dropwizard</a>, I had to start a new project from scratch. After some research, I chose to go with Ktor, for many reasons.</p><p>First of all, Ktor is built with Kotlin and coroutines, two things that I like.</p><p>Secondly, Ktor is lightweight and flexible, because you don’t have to import every feature, but only the things that you need. This is made possible with <a href=https://ktor.io/docs/plugins.html#install>plugins</a>, i.e. a specific feature (for example Compression, CORS, Cookies, etc) that you decide to install, only if you need it.</p><p>And last but not least, Ktor is unopinionated. This allows not to stick to a specific pattern or architecture but to choose the one that better suits the project. And it also allows knowledge transfer, because it will be possible to reuse the existing knowledge acquired in another domain, mobile in my case.</p><p>For these reasons, I found Ktor easy to use, with a gentle learning curve, even for a mobile developer.</p><h2 id=knowledge-transfer>Knowledge Transfer<a hidden class=anchor aria-hidden=true href=#knowledge-transfer>#</a></h2><p>The main topics that I needed to adapt are 3: architecture, dependency injection and testing.</p><h3 id=architecture>Architecture<a hidden class=anchor aria-hidden=true href=#architecture>#</a></h3><p>An Android application is usually divided into 4 different layers:</p><ul><li>Application</li><li>Presentation</li><li>Domain</li><li>Data</li></ul><p>The <strong>application layer</strong> is responsible for starting the application, together with all the different libraries and functionalities that are needed. For example dependency injection, logging, analytics, etc.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyApp</span> : Application() {
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>() {
        <span style=color:#66d9ef>super</span>.onCreate()

        <span style=color:#66d9ef>if</span> (BuildConfig.DEBUG) {
            Timber.plant(Timber.DebugTree())
        }

        initAnalytics()
        initCrashReporting()
        initRandomLib()
    }
}
</code></pre></div><p>The <strong>presentation</strong> layer is responsible for showing data to the user and interacting with it. In this layer, there are activities/fragments and ViewModels (or the equivalent in other patterns).</p><p>The <strong>domain</strong> layer takes care of the specific domain of the application. It is usually composed of <em>UseCases</em> and <em>Repositories</em> where the data are manipulated and prepared before being passed to the presentation layer.
This layer usually doesn’t contain any reference to the Android world.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JokeRepositoryImpl</span>(
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> jokeLocalDataSource: JokeLocalDataSource
) : JokeRepository {

    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>suspend</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getRandomJoke</span>(): JokeModel {
        <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>And finally, the <strong>data</strong> layer, which is the interface to the external world. This layer contains all the code required to retrieve data from the network or a database, for example by using Retrofit or Room.</p><p>On Ktor the layers are similar.</p><p>The <strong>application layer</strong> is responsible for starting the server, together with all the different libraries and functionalities that are needed. Here it is possible to choose <a href=https://ktor.io/docs/plugins.html>Ktor’s plugins</a> that are required in the server.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.module(testing: Boolean = <span style=color:#66d9ef>false</span>) {

    install(Koin) {
        slf4jLogger()
        modules(koinModules)
    }

    install(ContentNegotiation) {
        json()
    }

    install(CallLogging) {
        level = Level.INFO
    }

    install(Locations)

    routing {
      <span style=color:#f92672>..</span>.
    }
}
</code></pre></div><p>Since a server doesn’t have any UI, the presentation layer is a bit different than in a mobile application. In this case, it is necessary to expose API endpoints to the outside world and not show buttons, checkboxes, etc. I’ve called this layer <strong>Resource</strong>, but is a completely personal choice (another possible name could be <strong>Controller</strong>) since Ktor is unopinionated.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// JokeResource.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Route</span>.jokeEndpoint() {

    <span style=color:#66d9ef>val</span> jokeRepository <span style=color:#66d9ef>by</span> inject&lt;JokeRepository&gt;()

    <span style=color:#66d9ef>get</span>&lt;JokeEndpoint.Random&gt; {
        call.respond(jokeRepository.getRandomJoke())
    }

    post&lt;JokeEndpoint.Watch&gt; {  apiCallParams <span style=color:#f92672>-&gt;</span>
        <span style=color:#66d9ef>val</span> name = apiCallParams.name
        jokeRepository.watch(name)
        call.respond(<span style=color:#e6db74>&#34;Ok&#34;</span>)
    }
}
</code></pre></div><p>The <strong>domain</strong> layer will look the same as on Android. Here, there will be <em>UseCases</em> and <em>Repositories</em> where the data are manipulated and prepared before being passed to the presentation layer.</p><p>And finally, the concept of <strong>data</strong> layer will be the same. The only thing that will change is the libraries required to interact with the database or the network. To interact with the database, I chosed <a href=https://github.com/JetBrains/Exposed>Exposed</a>, an ORM developed by Jetbrains.</p><p>With all the required platform adaptations, the architecture layers are very similar in both the worlds.</p><figure><a href=/img/ktor-series/commons-layers.png><img loading=lazy src=/img/ktor-series/commons-layers.png></a></figure><p>For this reasons, all the patterns and knowledge used to architect an Android application can be easily adapted and reused to build a backend.</p><h3 id=dependency-injection>Dependency Injection<a hidden class=anchor aria-hidden=true href=#dependency-injection>#</a></h3><p>A topic that doesn’t require any additional knowledge is dependency injection.</p><p>On Ktor, <a href=https://insert-koin.io/docs/quickstart/ktor>Koin</a> can be used. And it behaves exactly like on Android: it is necessary to create a module, initialize Koin and then it will possible to retrieve the dependency.</p><p><strong>Android</strong>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> appModule = module {
   single&lt;HelloRepository&gt; { HelloRepositoryImpl() }
   factory { MySimplePresenter(<span style=color:#66d9ef>get</span>()) }
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyApplication</span> : Application() {

    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>() {
        <span style=color:#66d9ef>super</span>.onCreate()

        startKoin {
            androidLogger()
            androidContext(<span style=color:#66d9ef>this</span><span style=color:#a6e22e>@MyApplication</span>)
            modules(appModule)
        }
    }
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : AppCompatActivity() {

   <span style=color:#66d9ef>val</span> firstPresenter: MySimplePresenter <span style=color:#66d9ef>by</span> inject()

    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        <span style=color:#f92672>..</span>.
    }
}
</code></pre></div><p><strong>Ktor</strong>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> appModule = module {
    single&lt;JokeLocalDataSource&gt; { JokeLocalDataSourceImpl() }
    single&lt;JokeRepository&gt; { JokeRepositoryImpl(<span style=color:#66d9ef>get</span>()) }
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.module() {

    install(Koin) {
        slf4jLogger()
        modules(koinModules)
    }
    <span style=color:#f92672>..</span>.
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Route</span>.jokeEndpoint() {

    <span style=color:#66d9ef>val</span> jokeRepository <span style=color:#66d9ef>by</span> inject&lt;JokeRepository&gt;()

    <span style=color:#66d9ef>get</span>&lt;JokeEndpoint.Random&gt; {
        call.respond(jokeRepository.getRandomJoke())
    }

    <span style=color:#f92672>..</span>.
}
</code></pre></div><p>For more details about DI setup, you can look at the first instance of the series - <a href=https://www.marcogomiero.com/posts/2021/ktor-project-structure/>Structuring a Ktor project</a>.</p><h3 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h3><p>Also, testing doesn’t require a completely new set of knowledge. Unit testing will be exactly the same as on Android because it’s platform agnostic.</p><p>Integration testing instead will be friendlier and easier because no emulator is required.
In particular, Ktor does not create a web server but it hooks directly into the internal mechanism with a TestEngine. In this way, the execution of tests will be quicker rather than spinning up a complete web server for testing.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#a6e22e>@Test</span>
<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>testRequests</span>() = withTestApplication(module(testing = <span style=color:#66d9ef>true</span>)) {
    with(handleRequest(HttpMethod.Get, <span style=color:#e6db74>&#34;/&#34;</span>)) {
        assertEquals(HttpStatusCode.OK, response.status())
        assertEquals(<span style=color:#e6db74>&#34;Hello from Ktor Testable sample application&#34;</span>, response.content)
    }
}
</code></pre></div><p>For more details about testing on Ktor, you can look at the first instance of the series - <a href=https://www.marcogomiero.com/posts/2021/ktor-project-structure/>Structuring a Ktor project</a>.</p><h2 id=conclusions>Conclusions<a hidden class=anchor aria-hidden=true href=#conclusions>#</a></h2><p>Being unopinionated is the key to knowledge transfer. For this reason, mobile knowledge can be adapted and changed to be ready to develop backend applications with Ktor. However, there will be still some areas that requires more attention and a more deep dive, like scaling and deploying. That was one of the areas where I was lacking knowledge and where I asked for help.
But even without the full and complete knowledge, going to the ”other side” and trying new things was really a nice experience that can enrich your vision.</p><p>And that’s it for this series. You can check out the other instances of the series in the index above or <a href=https://twitter.com/marcoGomier>follow me on Twitter</a> for new content.</p><h2 id=bonus>Bonus:<a hidden class=anchor aria-hidden=true href=#bonus>#</a></h2><p>I’ve spoke about this topic in a talk <a href=https://www.marcogomiero.com/talks/2022/from-mobile-to-backend-ktor-fosdem/>in the Kotlin Dev Room at Fosdem 2022</a>.</p><p>Here’s the recording of the session:</p><br><video controls width=100%>
<source src=https://ftp.fau.de/fosdem/2022/D.kotlin/from_mobile_to_backend.webm type=video/webm></video></div><div class=article-footer><div class=post-content>To stay up to date with my writing and my projects, follow me on <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://www.marcogomiero.com/posts/2022/ktor-jobs-quartz/><span class=title>Next »</span><br><span>How to schedule jobs with Quartz on Ktor</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>