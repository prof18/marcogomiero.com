<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to handle database migrations with Liquibase on Ktor - Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SERIES: Building a backend with Ktor
Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5 Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor Databases are an important and critical part of backend infrastructures."><meta property="og:image" content><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><meta property="og:title" content="How to handle database migrations with Liquibase on Ktor"><meta property="og:description" content="SERIES: Building a backend with Ktor
Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5 Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor Databases are an important and critical part of backend infrastructures."><meta property="og:type" content="article"><meta property="og:url" content="https://www.marcogomiero.com/posts/2022/ktor-migration-liquibase/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-24T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-24T00:00:00+00:00"><meta property="og:site_name" content="Marco Gomiero"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to handle database migrations with Liquibase on Ktor"><meta name=twitter:description content="SERIES: Building a backend with Ktor
Part 1: Structuring a Ktor project Part 2: How to persist Ktor logs Part 3: How to use an in-memory database for testing on Ktor Part 4: How to handle database migrations with Liquibase on Ktor Part 5 Generate API documentation from Swagger on Ktor Part 6: How to schedule jobs with Quartz on Ktor Part 7: Moving from mobile to backend development with Ktor Databases are an important and critical part of backend infrastructures."><script async src="https://www.googletagmanager.com/gtag/js?id=G-69FZ1TLE7E"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-69FZ1TLE7E",{anonymize_ip:!1})}</script><script src=https://www.marcogomiero.com/js/feather.min.js></script>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.marcogomiero.com/css/main.f2c7f60ec2d0155a784ade9b1b272143e1b8eb864a95bf75e606b49d8774389e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://www.marcogomiero.com/css/dark.26c5bf79ef760a8f4feb8fc7be32ec86fc1f1da292b42c9fcc37879d4f774e3f.css disabled></head><body><div class=content><header><div class=main><a href=https://www.marcogomiero.com><h2>Marco Gomiero</h2></a></div><nav class=navbar><a href=/posts/><span>Write</span></a>
<a href=/talks/><span>Speak</span></a>
<a href=/projects/><span>Build</span></a>
<a href=/about-me/><span>About</span></a>
| <span class=dark-mode-toggle id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.marcogomiero.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>How to handle database migrations with Liquibase on Ktor</h1><div class=post-meta><span title='2022-01-24 00:00:00 +0000 UTC'>24 January 2022</span></div></div><section class=body><span class=raw-html><a href="https://us12.campaign-archive.com/?u=f39692e245b94f7fb693b6d82&id=f4f6d67da0"><img style=margin:0 src=https://img.shields.io/badge/Featured%20in%20kotlinweekly.net-Issue%20%23289-%237874b4></a></span><blockquote><p><strong>SERIES: Building a backend with Ktor</strong></p><ul><li>Part 1: <a href=https://www.marcogomiero.com/posts/2021/ktor-project-structure/>Structuring a Ktor project</a></li><li>Part 2: <a href=https://www.marcogomiero.com/posts/2021/ktor-logging-on-disk/>How to persist Ktor logs</a></li><li>Part 3: <a href=https://www.marcogomiero.com/posts/2021/ktor-in-memory-db-testing/>How to use an in-memory database for testing on Ktor</a></li><li>Part 4: How to handle database migrations with Liquibase on Ktor</li><li>Part 5 <a href=https://www.marcogomiero.com/posts/2022/ktor-setup-documentation/>Generate API documentation from Swagger on Ktor</a></li><li>Part 6: <a href=https://www.marcogomiero.com/posts/2022/ktor-jobs-quartz/>How to schedule jobs with Quartz on Ktor</a></li><li>Part 7: <a href=https://www.marcogomiero.com/posts/2022/backend-from-mobile-ktor/>Moving from mobile to backend development with Ktor</a></li></ul></blockquote><p>Databases are an important and critical part of backend infrastructures. They are the place where all the information is stored and that data cannot be compromised or lost. That’s why it is important to have proper management of the evolution of the database: it is necessary to be able to modify the schema, migrate the data, or roll back to a previous schema version if something unexpected happened.</p><p>There are many different products or tools to manage a database schema, for example <a href=https://github.com/flyway/flyway>Flyway</a> or <a href=https://github.com/liquibase/liquibase>Liquibase</a>.</p><p>In this article, I will cover how to set up Liquibase in a Ktor project and how to create two Gradle tasks responsible to migrate a test and a production MySQL database. There is also a <a href=https://www.liquibase.com/products>pro version</a> of Liquibase, but the free community version was enough for me.</p><p>This post is part of a series of posts dedicated to Ktor where I cover all the topics that made me struggle during development and that was not easy to achieve out of the box. You can check out the other instances of the series in the index above or <a href=https://twitter.com/marcoGomier>follow me on Twitter</a> to keep up to date.</p><h2 id=setup>Setup</h2><p>The first thing to do is to add all the required dependencies. The starting point is the <a href=https://github.com/liquibase/liquibase-gradle-plugin>Gradle plugin</a> in the <code>build.gradle.kts</code> file:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    id(<span style=color:#5af78e>&#34;org.liquibase.gradle&#34;</span>) version <span style=color:#5af78e>&#34;&lt;version-number&gt;&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>After syncing the project, it is possible to add now the required dependencies for the Liquibase runtime:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>liquibaseRuntime(<span style=color:#5af78e>&#34;org.liquibase:liquibase-core:</span><span style=color:#5af78e>$liquibase</span><span style=color:#5af78e>_core&#34;</span>)
</span></span><span style=display:flex><span>liquibaseRuntime(<span style=color:#5af78e>&#34;mysql:mysql-connector-java:</span><span style=color:#5af78e>$mysql</span><span style=color:#5af78e>_connector_version&#34;</span>)
</span></span><span style=display:flex><span>liquibaseRuntime(<span style=color:#5af78e>&#34;ch.qos.logback:logback-core:1.2.3&#34;</span>)
</span></span><span style=display:flex><span>liquibaseRuntime(<span style=color:#5af78e>&#34;ch.qos.logback:logback-classic:1.2.3&#34;</span>)
</span></span><span style=display:flex><span>liquibaseRuntime(<span style=color:#5af78e>&#34;javax.xml.bind:jaxb-api:2.2.4&#34;</span>)
</span></span></code></pre></div><p><em>Note that here <code>liquibaseRuntime</code> is used instead of the usual <code>implementation</code></em></p><p>Besides the core functionality, the other dependencies are necessary for the database connection, for logging, and for parsing XML, since all the data about the migrations will be saved in an XML file (as shown later on).</p><h2 id=configuring-the-migration-task>Configuring the migration task</h2><p>To perform the database migrations, it is necessary to connect to the database, and to do so, some access information, like the database URL, the user, and the password, need to be stored somewhere and retrieved.</p><p>The access information can be saved, for example, on <code>local.properties</code> or in the environment variables:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>liquibase.dev.url=jdbc:mysql://localhost:3308/chucknorris
</span></span><span style=display:flex><span>liquibase.dev.pwd=password
</span></span><span style=display:flex><span>liquibase.dev.user=root
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>liquibase.prod.url=jdbc\:mysql\://your-url.com
</span></span><span style=display:flex><span>liquibase.prod.pwd=password
</span></span><span style=display:flex><span>liquibase.prod.user=user
</span></span></code></pre></div><p>and can be retrieved in the <code>build.gradle.kts</code> file:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>val</span> propertiesFile = <span style=color:#ff6ac1>file</span>(<span style=color:#5af78e>&#34;local.properties&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> properties = Properties()
</span></span><span style=display:flex><span><span style=color:#ff6ac1>if</span> (propertiesFile.exists()) {
</span></span><span style=display:flex><span>    properties.load(propertiesFile.inputStream())
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> urlDev = properties.getProperty(<span style=color:#5af78e>&#34;liquibase.dev.url&#34;</span>) <span style=color:#ff6ac1>?:</span> System.getenv(<span style=color:#5af78e>&#34;LIQUIBASE_DEV_URL&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> userDev = properties.getProperty(<span style=color:#5af78e>&#34;liquibase.dev.user&#34;</span>) <span style=color:#ff6ac1>?:</span> System.getenv(<span style=color:#5af78e>&#34;LIQUIBASE_DEV_USER&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> pwdDev = properties.getProperty(<span style=color:#5af78e>&#34;liquibase.dev.pwd&#34;</span>) <span style=color:#ff6ac1>?:</span> System.getenv(<span style=color:#5af78e>&#34;LIQUIBASE_DEV_PWD&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> urlProd = properties.getProperty(<span style=color:#5af78e>&#34;liquibase.prod.url&#34;</span>) <span style=color:#ff6ac1>?:</span> System.getenv(<span style=color:#5af78e>&#34;LIQUIBASE_PROD_URL&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> userProd = properties.getProperty(<span style=color:#5af78e>&#34;liquibase.prod.user&#34;</span>) <span style=color:#ff6ac1>?:</span> System.getenv(<span style=color:#5af78e>&#34;LIQUIBASE_PROD_USER&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff6ac1>val</span> pwdProd = properties.getProperty(<span style=color:#5af78e>&#34;liquibase.prod.pwd&#34;</span>) <span style=color:#ff6ac1>?:</span> System.getenv(<span style=color:#5af78e>&#34;LIQUIBASE_PROD_PWD&#34;</span>)
</span></span></code></pre></div><p>The migration task can be configured and customized by providing some parameters in the <code>activities.register</code> block, inside the <code>liquibase</code> block.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>liquibase {
</span></span><span style=display:flex><span>    activities.register {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>this</span>.arguments = mapOf(
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;logLevel&#34;</span> to <span style=color:#5af78e>&#34;info&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;changeLogFile&#34;</span> to <span style=color:#5af78e>&#34;&lt;file-path&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;url&#34;</span> to urlProd,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;username&#34;</span> to userProd,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;password&#34;</span> to pwdProd,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The ones that I’ve provided are the following, but you can find more parameters in the <a href=https://docs.liquibase.com/commands/home.html>Liquibase documentation</a>:</p><ul><li><code>logInfo</code> -> execution log level (<code>debug</code>, <code>info</code>, <code>warning</code>, <code>severe</code>, <code>off</code>).</li><li><code>changeLogFile</code> -> the path of the changelog XML file to use;</li><li><code>url</code> -> database JDBC URL;</li><li><code>username</code> -> database username;</li><li><code>password</code> -> database password;</li></ul><p>The location where the changelog <code>XML</code> file and the <code>SQL</code> files can be freely chosen depending on the project. I’ve decided to put them in the <code>resources</code> folder of the project, with the following structure:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>.
</span></span><span style=display:flex><span>└── src
</span></span><span style=display:flex><span>    ├── main
</span></span><span style=display:flex><span>        ├── kotlin
</span></span><span style=display:flex><span>        └── resources
</span></span><span style=display:flex><span>            ├── db
</span></span><span style=display:flex><span>                └── migration
</span></span><span style=display:flex><span>                    ├── changesets
</span></span><span style=display:flex><span>                    │   ├── changeset-202102281045.sql
</span></span><span style=display:flex><span>                    │   └── changeset-202102281050.sql
</span></span><span style=display:flex><span>                    └── migrations.xml
</span></span></code></pre></div><p>The SQL files are contained in the <code>changesets</code> subfolder and are named with the following pattern to make the file unique: <code>changeset-YearMonthDayHourMinute.sql</code></p><p>The <code>migrations.xml</code> file contains the definitions of every migration:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#78787e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;databaseChangeLog</span>
</span></span><span style=display:flex><span>        <span style=color:#57c7ff>xmlns=</span><span style=color:#5af78e>&#34;http://www.liquibase.org/xml/ns/dbchangelog&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#57c7ff>xmlns:xsi=</span><span style=color:#5af78e>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#57c7ff>xsi:schemaLocation=</span><span style=color:#5af78e>&#34;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;changeSet</span> <span style=color:#57c7ff>id=</span><span style=color:#5af78e>&#34;202102281045&#34;</span> <span style=color:#57c7ff>author=</span><span style=color:#5af78e>&#34;Marco&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;comment&gt;</span>Jokes Table<span style=color:#ff6ac1>&lt;/comment&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;sqlFile</span> <span style=color:#57c7ff>path=</span><span style=color:#5af78e>&#34;src/main/resources/db/migration/changesets/changeset-202102281045.sql&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/changeSet&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;changeSet</span> <span style=color:#57c7ff>id=</span><span style=color:#5af78e>&#34;202102281050&#34;</span> <span style=color:#57c7ff>author=</span><span style=color:#5af78e>&#34;Marco&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;comment&gt;</span>Jokes Data<span style=color:#ff6ac1>&lt;/comment&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>&lt;sqlFile</span> <span style=color:#57c7ff>path=</span><span style=color:#5af78e>&#34;src/main/resources/db/migration/changesets/changeset-202102281050.sql&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;/changeSet&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/databaseChangeLog&gt;</span>
</span></span></code></pre></div><p>Every migration is represented by a <code>changeSet</code>, that has a unique ID. An ID could be, for example, the <em>YearMonthDayHourMinute</em> used for the file name.
In the changeSet object, it is necessary to provide the path of the SQL file for the migration, and also a comment can be added.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff6ac1>&lt;changeSet</span> <span style=color:#57c7ff>id=</span><span style=color:#5af78e>&#34;202102281050&#34;</span> <span style=color:#57c7ff>author=</span><span style=color:#5af78e>&#34;Marco&#34;</span><span style=color:#ff6ac1>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;comment&gt;</span>Jokes Data<span style=color:#ff6ac1>&lt;/comment&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>&lt;sqlFile</span> <span style=color:#57c7ff>path=</span><span style=color:#5af78e>&#34;src/main/resources/db/migration/changesets/changeset-202102281050.sql&#34;</span><span style=color:#ff6ac1>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>&lt;/changeSet&gt;</span>
</span></span></code></pre></div><p>Finally, at this point, it is possible to run the Gradle task that will perform the database migration.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./gradlew update
</span></span></code></pre></div><h2 id=migrating-multiple-databases>Migrating multiple databases</h2><p>As shown above, every <code>activity</code> registered in the <code>liquibase</code> block corresponds to a different database instance to connect to. However, to connect and migrate different databases instances, it is necessary to register different <code>activity</code> with different names.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>liquibase {
</span></span><span style=display:flex><span>    activities.register(<span style=color:#5af78e>&#34;dev&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>this</span>.arguments = mapOf(
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;logLevel&#34;</span> to <span style=color:#5af78e>&#34;info&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;changeLogFile&#34;</span> to <span style=color:#5af78e>&#34;&lt;file-path&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;url&#34;</span> to urlDev,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;username&#34;</span> to userDev,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;password&#34;</span> to pwdDev,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    activities.register(<span style=color:#5af78e>&#34;prod&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>this</span>.arguments = mapOf(
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;logLevel&#34;</span> to <span style=color:#5af78e>&#34;info&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;changeLogFile&#34;</span> to <span style=color:#5af78e>&#34;&lt;file-path&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;url&#34;</span> to urlProd,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;username&#34;</span> to userProd,
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;password&#34;</span> to pwdProd,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>By default, the Liquibase plugin will run every activity. However, it is possible to set the <code>runList</code> parameter with the name of the activities to run:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>liquibase {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>..</span>.
</span></span><span style=display:flex><span>    runList = <span style=color:#ff5c57>“</span>dev,prod<span style=color:#ff5c57>”</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The value of the parameter can also be provided from the command line when running the Gradle task. To do that, it is necessary to first define an empty variable in the <code>gradle.properties</code> file:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>dbEnv=
</span></span></code></pre></div><p>Then the variable will be retrieved in the <code>build.gradle.kts</code> file and assigned to the <code>runList</code> parameter:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>val</span> dbEnv: String <span style=color:#ff6ac1>by</span> project.ext
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>liquibase {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>..</span>.
</span></span><span style=display:flex><span>    runList = dbEnv
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The value of the variable can then be injected from the command line with the following argument:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./gradlew update -PdbEnv<span style=color:#ff6ac1>=</span>dev
</span></span></code></pre></div><h2 id=conclusions>Conclusions</h2><p>And that’s it for today. You can find the code mentioned in the article on <a href=https://github.com/prof18/ktor-chuck-norris-sample/tree/main/part4>GitHub</a>.</p><p>In the next episode, I’ll cover how to show the API documentation from a Swagger specification. You can follow me on <a href=https://twitter.com/marcoGomier>Twitter</a> to know when I’ll publish the next episodes.</p></section><div class=article-footer><div class=body>To stay up to date with my writing and my projects, follow me on <a href=https://bsky.app/profile/marcogomiero.com target=_blank>Bluesky</a>, <a href=https://androiddev.social/@marcogom target=_blank>Mastodon</a> or <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.marcogomiero.com>Marco Gomiero</a></span></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-69FZ1TLE7E","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>