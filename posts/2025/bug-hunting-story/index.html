<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>The curious case of a weird VerifyError crash - Marco Gomiero</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="This post can be considered as a journal entry. I had to clear my thoughts and vent off through writing after spending time debugging this issue. Maybe it will be helpful for future references or an example of the process to follow in such cases.
The other day I was doing the usual dependency update routine of FeedFlow when I discovered a runtime crash that happened in the release version (so with R8 enabled) after updating the Android Gradle Plugin (AGP, in the rest of the article) to version 8."><meta property="og:image" content><meta name=google-site-verification content="7rDTNqn214SsZ9mmV8Ps5v2vqy8aXFWyoq08udChYCs"><meta property="og:url" content="https://www.marcogomiero.com/posts/2025/bug-hunting-story/"><meta property="og:site_name" content="Marco Gomiero"><meta property="og:title" content="The curious case of a weird VerifyError crash"><meta property="og:description" content="This post can be considered as a journal entry. I had to clear my thoughts and vent off through writing after spending time debugging this issue. Maybe it will be helpful for future references or an example of the process to follow in such cases.
The other day I was doing the usual dependency update routine of FeedFlow when I discovered a runtime crash that happened in the release version (so with R8 enabled) after updating the Android Gradle Plugin (AGP, in the rest of the article) to version 8."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-06T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="The curious case of a weird VerifyError crash"><meta name=twitter:description content="This post can be considered as a journal entry. I had to clear my thoughts and vent off through writing after spending time debugging this issue. Maybe it will be helpful for future references or an example of the process to follow in such cases.
The other day I was doing the usual dependency update routine of FeedFlow when I discovered a runtime crash that happened in the release version (so with R8 enabled) after updating the Android Gradle Plugin (AGP, in the rest of the article) to version 8."><script async src="https://www.googletagmanager.com/gtag/js?id=G-69FZ1TLE7E"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-69FZ1TLE7E")}</script><script src=https://www.marcogomiero.com//js/feather.min.js></script><link href="https://fonts.googleapis.com/css?family=JetBrains+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.marcogomiero.com/css/main.f2c7f60ec2d0155a784ade9b1b272143e1b8eb864a95bf75e606b49d8774389e.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://www.marcogomiero.com/css/dark.26c5bf79ef760a8f4feb8fc7be32ec86fc1f1da292b42c9fcc37879d4f774e3f.css disabled></head><body><div class=content><header><div class=main><a href=https://www.marcogomiero.com/><h2>Marco Gomiero</h2></a></div><nav class=navbar><a href=/posts/><span>Write
</span></a><a href=/talks/><span>Speak
</span></a><a href=/projects/><span>Build
</span></a><a href=/about-me/><span>About
</span></a>| <span class=dark-mode-toggle id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.marcogomiero.com//js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>The curious case of a weird VerifyError crash</h1><div class=post-meta>&lt;span title='2025-04-06 00:00:00 +0000 UTC'>6 April 2025&lt;/span></div></div><section class=body><blockquote><p>This post can be considered as a journal entry. I had to clear my thoughts and vent off through writing after spending time debugging this issue. Maybe it will be helpful for future references or an example of the process to follow in such cases.</p></blockquote><figure><a href=/img/bug-hunting-story/coffe.jpeg><img src=/img/bug-hunting-story/coffe.jpeg></a></figure><p>The other day I was doing the usual dependency update routine of <a href=https://www.feedflow.dev>FeedFlow</a> when I discovered a runtime crash that happened in the release version (so with R8 enabled) after updating the Android Gradle Plugin (AGP, in the rest of the article) to version 8.7.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>java.lang.VerifyError: Verifier rejected class t0.r: 
</span></span><span style=display:flex><span>void t0.r.h(t0.r) failed to verify: void t0.r.h(t0.r): 
</span></span><span style=display:flex><span>[0x5] register v0 has type Precise Reference: java.lang.Integer 
</span></span><span style=display:flex><span>but expected Precise Reference: L0.j (declaration of &#39;t0.r&#39; 
</span></span><span style=display:flex><span>appears in /data/app/~~_cXzOXLfk4yLcG5sVXzehg==/com.prof18.feedflow-D_r-DXHofuTMpeXekhA6iA==/base.apk)
</span></span></code></pre></div><p>Interesting.</p><p>A first good old web search didn’t bring up anything, and neither did asking LLMs, so down the rabbit hole I went to understand the issue.</p><p>First thought: it could be something weird happening with R8 (<em>spoiler: it is</em>). But I haven’t found anything interesting while checking AGP release notes.</p><p>I immediately thought, it must be some mess-up with Compose, Compose Multiplatform, Compose Compiler, or libraries that use Compose. (Yes, scars from the past, even though it should be less painful now with Kotlin 2.0 and the compiler being in the Kotlin repo).</p><p>Let’s double check every version and combination of libraries to be sure there’s no mess. Even after an analysis of transitive dependencies (<code>./gradlew androidApp:dependencies</code>), nothing suspicious came up.</p><p>All right, it must be an issue with the Kotlin version. Let’s try again with different combinations. <em>Nope, still crashing</em>.</p><p>At this point I decided to turn on the best debugger in town: <em>going for a walk</em>.</p><p>While strolling around, I came up with an attack plan: I’m gonna delete (temporarily, of course) all the code in the Android module, comment out all the dependencies, and only keep the <code>Application</code> class and the <code>MainActivity</code>.</p><p>With this plan in mind, I started. First, I tried to set up Compose again: it worked! So, Compose is not the issue anymore.</p><p>Next step: Koin. I added back the code that creates the dependency graph in the <code>Application</code> class and boom! The crash was back. Ok, then it must be some mess up with Koin and Compose versions. After trying all the combinations, the crash was still there.</p><p>All right, then it has to be something in the dependency graph. So I commented everything in the graph definition and started going step by step, uncommenting pieces one at a time. After a bunch of waiting, I got the suspect: <code>feedFetcherRepository.fetchFeeds()</code> is making the app crash!</p><p>Another deep dive with the same approach until I found a new suspect: <code>dateFormatter.getDateMillisFromString(pubDate)</code>.</p><p>In particular, the list with the <code>DateTimeFormat</code> for parsing a date string with <a href=https://github.com/Kotlin/kotlinx-datetime>kotlin-datetime</a> is causing the crash. Very weird!</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#ff6ac1>private</span> <span style=color:#ff6ac1>val</span> formats = listOf&lt;DateTimeFormat&lt;DateTimeComponents&gt;&gt;(
</span></span><span style=display:flex><span>    ISO_DATE_TIME_OFFSET,
</span></span><span style=display:flex><span>    RFC_1123,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#78787e>// Tue, 5 Sep 2017 09:58:38 +0000
</span></span></span><span style=display:flex><span><span style=color:#78787e></span>    Format {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>..</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>)	
</span></span></code></pre></div><p>After a search in the issues of the library, I found something similar! An issue that was closed because the problem could not be reproduced, both on <a href=https://github.com/Kotlin/kotlinx-datetime/issues/402>JetBrains</a> and <a href=https://issuetracker.google.com/issues/351858994>Google</a> sides. But now <a href=https://github.com/prof18/DateTimeR8IssueRepro>there&rsquo;s a reproducer!</a>.</p><p>Apparently, the issue could be that R8 removes classes that are backing some properties with delegation.</p><p>Now that I’ve found the cause of this crash, I’m relieved and I can postpone updating AGP without overthinking.</p></section><div class=article-footer><div class=body>To stay up to date with my writing and my projects, follow me on <a href=https://bsky.app/profile/marcogomiero.com target=_blank>Bluesky</a>, <a href=https://androiddev.social/@marcogom target=_blank>Mastodon</a> or <a href=https://twitter.com/marcoGomier target=_blank>Twitter</a>. If you have any questions, feel free to reach me out!</div></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.marcogomiero.com/>Marco Gomiero</a></span></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-69FZ1TLE7E"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-69FZ1TLE7E")}</script></div></body></html>